(()=>{var t={n:a=>{var n=a&&a.__esModule?()=>a.default:()=>a;return t.d(n,{a:n}),n},d:(a,n)=>{for(var e in n)t.o(n,e)&&!t.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:n[e]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";function n(t,a){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},n(t,a)}function e(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,n(t,a)}t.r(a),t.d(a,{components:()=>J,extend:()=>E,helpers:()=>j,models:()=>r});const o=flarum.core.compat["common/Model"];var s=t.n(o),i=function(t){function a(){return t.apply(this,arguments)||this}e(a,t);var n=a.prototype;return n.points=function(){return s().attribute("points").call(this)},n.name=function(){return s().attribute("name").call(this)},n.color=function(){return s().attribute("color").call(this)},a}(s()),r={Rank:i};const l=flarum.core.compat["admin/app"];var c=t.n(l);const u=flarum.core.compat["admin/components/ExtensionPage"];var f=t.n(u);const p=flarum.core.compat["common/components/Button"];var d=t.n(p);const g=flarum.core.compat["admin/utils/saveSettings"];var v=t.n(g);const h=flarum.core.compat["common/components/Switch"];var b=t.n(h);const k=flarum.core.compat["common/utils/withAttr"];var w=t.n(k);const y=flarum.core.compat["common/utils/Stream"];var P=t.n(y);const N=flarum.core.compat["common/utils/ItemList"];var _=t.n(N);const R=flarum.core.compat["admin/components/UploadImageButton"];var x=function(t){function a(){return t.apply(this,arguments)||this}return e(a,t),a.prototype.resourceUrl=function(){return c().forum.attribute("apiUrl")+"/"+this.attrs.path},a}(t.n(R)());const I=flarum.core.compat["common/Component"];var S=t.n(I);const O=flarum.core.compat["common/components/Select"];var A=t.n(O);const L=flarum.core.compat["common/components/Tooltip"];var U=t.n(L);const C=flarum.core.compat["common/utils/extractText"];var M=t.n(C);const B=flarum.core.compat["common/models/Group"];var V=t.n(B),D=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(a=t.call.apply(t,[this].concat(e))||this).newGroupId=P()(""),a.newMinPoints=P()(""),a.newMaxPoints=P()(""),a}return e(a,t),a.prototype.view=function(){var t=this,a=[];try{a=JSON.parse(this.attrs.value)}catch(t){}Array.isArray(a)||(a=[]);var n={};return c().store.all("groups").forEach((function(t){-1===[V().ADMINISTRATOR_ID,V().MEMBER_ID,V().GUEST_ID].indexOf(t.id())&&(n[t.id()]=t.nameSingular())})),m("table",null,m("thead",null,m("tr",null,m("th",null,c().translator.trans("fof-gamification.admin.page.groups.column.group")),m("th",null,c().translator.trans("fof-gamification.admin.page.groups.column.minPoints")),m("th",null,c().translator.trans("fof-gamification.admin.page.groups.column.maxPoints")))),m("tbody",null,a.map((function(e,o){var s=function(n){return function(o){""===o?delete e[n]:e[n]=parseInt(o),t.attrs.onchange(JSON.stringify(a))}};return m("tr",null,m("td",null,m(A(),{options:n,value:e.groupId+"",onchange:s("groupId")})),m("td",null,m("input",{className:"FormControl",type:"number",value:e.minPoints||"",onchange:w()("value",s("minPoints"))})),m("td",null,m("input",{className:"FormControl",type:"number",value:e.maxPoints||"",onchange:w()("value",s("maxPoints"))})),m("td",null,m(U(),{text:M()(c().translator.trans("fof-gamification.admin.page.groups.delete"))},m(d(),{className:"Button Button--icon",icon:"fas fa-times",onclick:function(){a.splice(o,1),t.attrs.onchange(JSON.stringify(a))}},"Delete"))))})),m("tr",null,m("td",null,m(A(),{options:n,value:this.newGroupId(),onchange:this.newGroupId})),m("td",null,m("input",{className:"FormControl",type:"number",bidi:this.newMinPoints})),m("td",null,m("input",{className:"FormControl",type:"number",bidi:this.newMaxPoints})),m("td",null,m(U(),{text:M()(c().translator.trans("fof-gamification.admin.page.groups.add"))},m(d(),{className:"Button Button--icon",icon:"fas fa-plus",onclick:function(){var n={groupId:parseInt(t.newGroupId())};t.newMinPoints()&&(n.minPoints=parseInt(t.newMinPoints())),t.newMaxPoints()&&(n.maxPoints=parseInt(t.newMaxPoints())),a.push(n),t.attrs.onchange(JSON.stringify(a)),t.newGroupId(""),t.newMinPoints(""),t.newMaxPoints("")},disabled:!this.newGroupId()},"Add"))))))},a}(S()),T=function(t){function a(){return t.apply(this,arguments)||this}e(a,t);var n=a.prototype;return n.oninit=function(a){var n=this;t.prototype.oninit.call(this,a),this.fields=["convertedLikes","amountPerPost","amountPerDiscussion","postStartAmount","rankAmt","iconName","blockedUsers","iconNameAlt","autoAssignedGroups"],this.switches=["autoUpvotePosts","customRankingImages","rateLimit","showVotesOnDiscussionPage","useAlternateLayout","altPostVotingUi","upVotesOnly","firstPostOnly","allowSelfVotes"],this.ranks=c().store.all("ranks"),this.values={},this.settingsPrefix="fof-gamification";var e=c().data.settings;this.fields.forEach((function(t){return n.values[t]=P()(e[n.addPrefix(t)])})),this.switches.forEach((function(t){return n.values[t]=P()(!!Number(e[n.addPrefix(t)]))})),this.newRank={points:P()(""),name:P()(""),color:P()("")}},n.content=function(){return m("div",{className:"SettingsPage"},m("div",{className:"container"},m("form",{onsubmit:this.onsubmit.bind(this)},this.settingsItems().toArray())))},n.updateName=function(t,a){t.save({name:a})},n.updatePoints=function(t,a){t.save({points:a})},n.updateColor=function(t,a){t.save({color:a})},n.deleteRank=function(t){var a=this;t.delete(),this.ranks.some((function(n,e){if(n.data.id===t.data.id)return a.ranks.splice(e,1),!0}))},n.addRank=function(){var t=this;c().store.createRecord("ranks").save({points:this.newRank.points(),name:this.newRank.name(),color:this.newRank.color()}).then((function(){t.newRank.color(""),t.newRank.name(""),t.newRank.points(""),m.redraw()}))},n.changed=function(){var t=this,a=this.switches.some((function(a){return t.values[a]()!==("1"==c().data.settings[t.addPrefix(a)])}));return this.fields.some((function(a){return t.values[a]()!==c().data.settings[t.addPrefix(a)]}))||a},n.prepareSubmissionData=function(){var t=this,a={};return this.switches.forEach((function(n){return a[t.addPrefix(n)]=t.values[n]()})),this.fields.forEach((function(n){return a[t.addPrefix(n)]=t.values[n]()})),a},n.onsubmit=function(t){var a=this;t.preventDefault(),this.loading||(this.loading=!0,c().alerts.dismiss(this.successAlert),v()(this.prepareSubmissionData()).then(this.onsaved.bind(this)).then((function(){return window.location.reload()})).catch(console.error).then((function(){a.loading=!1})))},n.addPrefix=function(t){return this.settingsPrefix+"."+t},n.settingsItems=function(){var t=this,a=new(_());return a.add("convertLikesToUpvotes",m("div",null,m("div",{className:"helpText"},c().translator.trans("fof-gamification.admin.page.convert.help")),void 0===this.values.convertedLikes()?m(d(),{type:"button",className:"Button Button--warning Ranks-button","aria-label":c().translator.trans("fof-gamification.admin.page.convert.button"),onclick:function(){c().request({url:c().forum.attribute("apiUrl")+"/fof/gamification/convert",method:"POST"}).then(t.values.convertedLikes("converting"))}},c().translator.trans("fof-gamification.admin.page.convert.button")):"converting"===this.values.convertedLikes()?m("label",null,c().translator.trans("fof-gamification.admin.page.convert.converting")):m("label",null," ",c().translator.trans("fof-gamification.admin.page.convert.converted",{number:this.values.convertedLikes()}))),100),a.add("ranks",m("fieldset",{className:"SettingsPage-ranks"},m("legend",null,c().translator.trans("fof-gamification.admin.page.ranks.title")),m("label",null,c().translator.trans("fof-gamification.admin.page.ranks.ranks")),m("div",{className:"helpText"},c().translator.trans("fof-gamification.admin.page.ranks.help.help")),m("div",{className:"Ranks--Container"},this.ranks.map((function(a){return m("div",null,m("input",{className:"FormControl Ranks-number",type:"number",value:a.points(),placeholder:c().translator.trans("fof-gamification.admin.page.ranks.help.points"),oninput:w()("value",t.updatePoints.bind(t,a))}),m("input",{className:"FormControl Ranks-name",value:a.name(),placeholder:c().translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:w()("value",t.updateName.bind(t,a))}),m("input",{className:"FormControl Ranks-color",value:a.color(),placeholder:c().translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:w()("value",t.updateColor.bind(t,a))}),m(d(),{type:"button",className:"Button Button--warning Ranks-button",icon:"fa fa-times",onclick:t.deleteRank.bind(t,a)}))}))),m("div",null,m("input",{className:"FormControl Ranks-number",value:this.newRank.points(),placeholder:c().translator.trans("fof-gamification.admin.page.ranks.help.points"),type:"number",oninput:w()("value",this.newRank.points)}),m("input",{className:"FormControl Ranks-name",value:this.newRank.name(),placeholder:c().translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:w()("value",this.newRank.name)}),m("input",{className:"FormControl Ranks-color",value:this.newRank.color(),placeholder:c().translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:w()("value",this.newRank.color)}),m(d(),{type:"button",className:"Button Button--warning Ranks-button",icon:"fa fa-plus","aria-label":"add",onclick:this.addRank.bind(this)})),m("label",null,c().translator.trans("fof-gamification.admin.page.ranks.number_title")),m("input",{className:"FormControl Ranks-default",value:this.values.rankAmt(),type:"number",min:"0",oninput:w()("value",this.values.rankAmt)})),90),a.add("voteSettings",m("[",null,m("legend",null,c().translator.trans("fof-gamification.admin.page.votes.title")),this.voteItems().toArray()),80),a.add("rankingsPage",m("[",null,m("legend",null,c().translator.trans("fof-gamification.admin.page.rankings.title")),this.rankingsItems().toArray()),70),a.add("groups",m("fieldset",{className:"SettingsPage-groups"},m("legend",null,c().translator.trans("fof-gamification.admin.page.groups.title")),m("div",{className:"helpText"},c().translator.trans("fof-gamification.admin.page.groups.help")),m(D,{value:this.values.autoAssignedGroups(),onchange:this.values.autoAssignedGroups})),60),a.add("submit",m(d(),{type:"submit",className:"Button Button--primary Ranks-save",loading:this.loading,disabled:!this.changed()},c().translator.trans("fof-gamification.admin.page.save_settings")),0),a},n.voteItems=function(){var t=new(_());return t.add("icon",m("[",null,m("label",null,c().translator.trans("fof-gamification.admin.page.votes.icon_name")),m("div",{className:"helpText"},c().translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconName()||"",placeholder:"thumbs",oninput:w()("value",this.values.iconName)})),100),t.add("altIcon",m("[",null,m("label",null,c().translator.trans("fof-gamification.admin.page.alt_votes.icon_name")),m("div",{className:"helpText"},c().translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconNameAlt()||"",placeholder:"arrow",oninput:w()("value",this.values.iconNameAlt)})),90),t.add("autoUpvote",m(b(),{state:this.values.autoUpvotePosts()||!1,onchange:this.values.autoUpvotePosts,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.auto_upvote")),80),t.add("rateLimit",m(b(),{state:this.values.rateLimit()||!1,onchange:this.values.rateLimit,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.rate_limit")),70),t.add("opVotesOnDiscussionList",m(b(),{state:this.values.showVotesOnDiscussionPage()||!1,onchange:this.values.showVotesOnDiscussionPage,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.discussion_page")),60),t.add("altDiscussionListLayout",m(b(),{state:this.values.useAlternateLayout()||!1,onchange:this.values.useAlternateLayout,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.alternate_layout")),50),t.add("altPostLayout",m(b(),{state:this.values.altPostVotingUi()||!1,onchange:this.values.altPostVotingUi,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.alternate_post_layout")),40),t.add("upvotesOnly",m(b(),{state:this.values.upVotesOnly()||!1,onchange:this.values.upVotesOnly,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.upvotes_only")),30),t.add("firstPostOnly",m(b(),{state:this.values.firstPostOnly()||!1,onchange:this.values.firstPostOnly,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.first_post_only")),20),t.add("allowSelfVotes",m(b(),{state:this.values.allowSelfVotes(),onchange:this.values.allowSelfVotes,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.votes.allow_self_votes")),10),t},n.rankingsItems=function(){var t=new(_());return t.add("customImages",m(b(),{state:this.values.customRankingImages()||!1,onchange:this.values.customRankingImages,className:"votes-switch"},c().translator.trans("fof-gamification.admin.page.rankings.enable")),100),t.add("ignoredUsers",m("[",null,m("label",null,c().translator.trans("fof-gamification.admin.page.rankings.blocked.title")),m("input",{className:"FormControl Ranks-blocked",placeholder:c().translator.trans("fof-gamification.admin.page.rankings.blocked.placeholder"),value:this.values.blockedUsers()||"",oninput:w()("value",this.values.blockedUsers)})),90),t.add("customImages",m("[",null,m("div",{className:"helpText"},c().translator.trans("fof-gamification.admin.page.rankings.blocked.help")),[1,2,3].map((function(t){return m("[",null,m("label",{className:"Upload-label"},c().translator.trans("fof-gamification.admin.page.rankings.custom_image_"+t)),m(x,{className:"Upload-button",name:"fof-gamification.topimage"+t,path:"fof/gamification/topimage"+t,"aria-label":c().translator.trans("fof-gamification.admin.page.rankings.custom_image_"+t)}),m("br",null))}))),80),t},a}(f());const F=flarum.core.compat["common/extenders"],G=[(new(t.n(F)().Store)).add("ranks",i)],E=[].concat(G);var j={rankLabel:function(t,a){void 0===a&&(a={}),a.style=a.style||{},a.className="rankLabel "+(a.className||"");var n=t.color();return a.style.backgroundColor=a.style.color=n,a.className+=" colored",m("span",a,m("span",{className:"rankLabel-text"},t.name()))}},J={SettingsPage:T,UploadImageButton:x};c().initializers.add("fof-gamification",(function(t){t.extensionData.for("fof-gamification").registerPermission({icon:"fas fa-thumbs-up",label:t.translator.trans("fof-gamification.admin.permissions.vote_label"),permission:"discussion.votePosts"},"reply").registerPermission({icon:"fas fa-thumbs-up",label:t.translator.trans("fof-gamification.admin.permissions.see_votes_label"),permission:"discussion.canSeeVotes",allowGuest:!0},"view").registerPermission({icon:"fas fa-info-circle",label:t.translator.trans("fof-gamification.admin.permissions.see_voters_label"),permission:"discussion.canSeeVoters",allowGuest:!0},"view").registerPermission({icon:"fas fa-trophy",label:t.translator.trans("fof-gamification.admin.permissions.see_ranking_page"),permission:"fof.gamification.viewRankingPage",allowGuest:!0},"view").registerPermission({icon:"fas fa-bell",label:t.translator.trans("fof-gamification.admin.permissions.upvote_notifications"),permission:"discussion.upvote_notifications"},"view").registerPermission({icon:"fas fa-bell",label:t.translator.trans("fof-gamification.admin.permissions.downvote_notifications"),permission:"discussion.downvote_notifications"},"view").registerPage(T)}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map