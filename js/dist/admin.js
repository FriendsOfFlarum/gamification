(()=>{var a={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return a.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)a.o(n,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(a,t)=>Object.prototype.hasOwnProperty.call(a,t),r:a=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}},t={};(()=>{"use strict";function n(a,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,t){return a.__proto__=t,a},n(a,t)}function o(a,t){a.prototype=Object.create(t.prototype),a.prototype.constructor=a,n(a,t)}a.r(t),a.d(t,{components:()=>E,helpers:()=>G,models:()=>l});const e=flarum.core.compat["common/Model"];var s=a.n(e);const i=flarum.core.compat["common/utils/mixin"];var r=function(a){function t(){return a.apply(this,arguments)||this}return o(t,a),t}(a.n(i)()(s(),{points:s().attribute("points"),name:s().attribute("name"),color:s().attribute("color")})),l={Rank:r};const c=flarum.core.compat["admin/app"];var u=a.n(c);const f=flarum.core.compat["admin/components/ExtensionPage"];var p=a.n(f);const d=flarum.core.compat["common/components/Button"];var g=a.n(d);const v=flarum.core.compat["admin/utils/saveSettings"];var h=a.n(v);const b=flarum.core.compat["common/components/Switch"];var k=a.n(b);const w=flarum.core.compat["common/utils/withAttr"];var y=a.n(w);const P=flarum.core.compat["common/utils/Stream"];var N=a.n(P);const _=flarum.core.compat["common/utils/ItemList"];var R=a.n(_);const x=flarum.core.compat["admin/components/UploadImageButton"];var I=function(a){function t(){return a.apply(this,arguments)||this}return o(t,a),t.prototype.resourceUrl=function(){return u().forum.attribute("apiUrl")+"/"+this.attrs.path},t}(a.n(x)());const S=flarum.core.compat["common/Component"];var O=a.n(S);const A=flarum.core.compat["common/components/Select"];var L=a.n(A);const U=flarum.core.compat["common/components/Tooltip"];var C=a.n(U);const M=flarum.core.compat["common/utils/extractText"];var B=a.n(M);const V=flarum.core.compat["common/models/Group"];var D=a.n(V),T=function(a){function t(){for(var t,n=arguments.length,o=new Array(n),e=0;e<n;e++)o[e]=arguments[e];return(t=a.call.apply(a,[this].concat(o))||this).newGroupId=N()(""),t.newMinPoints=N()(""),t.newMaxPoints=N()(""),t}return o(t,a),t.prototype.view=function(){var a=this,t=[];try{t=JSON.parse(this.attrs.value)}catch(a){}Array.isArray(t)||(t=[]);var n={};return u().store.all("groups").forEach((function(a){-1===[D().ADMINISTRATOR_ID,D().MEMBER_ID,D().GUEST_ID].indexOf(a.id())&&(n[a.id()]=a.nameSingular())})),m("table",null,m("thead",null,m("tr",null,m("th",null,u().translator.trans("fof-gamification.admin.page.groups.column.group")),m("th",null,u().translator.trans("fof-gamification.admin.page.groups.column.minPoints")),m("th",null,u().translator.trans("fof-gamification.admin.page.groups.column.maxPoints")))),m("tbody",null,t.map((function(o,e){var s=function(n){return function(e){""===e?delete o[n]:o[n]=parseInt(e),a.attrs.onchange(JSON.stringify(t))}};return m("tr",null,m("td",null,m(L(),{options:n,value:o.groupId+"",onchange:s("groupId")})),m("td",null,m("input",{className:"FormControl",type:"number",value:o.minPoints||"",onchange:y()("value",s("minPoints"))})),m("td",null,m("input",{className:"FormControl",type:"number",value:o.maxPoints||"",onchange:y()("value",s("maxPoints"))})),m("td",null,m(C(),{text:B()(u().translator.trans("fof-gamification.admin.page.groups.delete"))},m(g(),{className:"Button Button--icon",icon:"fas fa-times",onclick:function(){t.splice(e,1),a.attrs.onchange(JSON.stringify(t))}},"Delete"))))})),m("tr",null,m("td",null,m(L(),{options:n,value:this.newGroupId(),onchange:this.newGroupId})),m("td",null,m("input",{className:"FormControl",type:"number",bidi:this.newMinPoints})),m("td",null,m("input",{className:"FormControl",type:"number",bidi:this.newMaxPoints})),m("td",null,m(C(),{text:B()(u().translator.trans("fof-gamification.admin.page.groups.add"))},m(g(),{className:"Button Button--icon",icon:"fas fa-plus",onclick:function(){var n={groupId:parseInt(a.newGroupId())};a.newMinPoints()&&(n.minPoints=parseInt(a.newMinPoints())),a.newMaxPoints()&&(n.maxPoints=parseInt(a.newMaxPoints())),t.push(n),a.attrs.onchange(JSON.stringify(t)),a.newGroupId(""),a.newMinPoints(""),a.newMaxPoints("")},disabled:!this.newGroupId()},"Add"))))))},t}(O()),F=function(a){function t(){return a.apply(this,arguments)||this}o(t,a);var n=t.prototype;return n.oninit=function(t){var n=this;a.prototype.oninit.call(this,t),this.fields=["convertedLikes","amountPerPost","amountPerDiscussion","postStartAmount","rankAmt","iconName","blockedUsers","iconNameAlt","autoAssignedGroups"],this.switches=["autoUpvotePosts","customRankingImages","rateLimit","showVotesOnDiscussionPage","useAlternateLayout","altPostVotingUi","upVotesOnly","firstPostOnly","allowSelfVotes"],this.ranks=u().store.all("ranks"),this.values={},this.settingsPrefix="fof-gamification";var o=u().data.settings;this.fields.forEach((function(a){return n.values[a]=N()(o[n.addPrefix(a)])})),this.switches.forEach((function(a){return n.values[a]=N()(!!Number(o[n.addPrefix(a)]))})),this.newRank={points:N()(""),name:N()(""),color:N()("")}},n.content=function(){return m("div",{className:"SettingsPage"},m("div",{className:"container"},m("form",{onsubmit:this.onsubmit.bind(this)},this.settingsItems().toArray())))},n.updateName=function(a,t){a.save({name:t})},n.updatePoints=function(a,t){a.save({points:t})},n.updateColor=function(a,t){a.save({color:t})},n.deleteRank=function(a){var t=this;a.delete(),this.ranks.some((function(n,o){if(n.data.id===a.data.id)return t.ranks.splice(o,1),!0}))},n.addRank=function(){var a=this;u().store.createRecord("ranks").save({points:this.newRank.points(),name:this.newRank.name(),color:this.newRank.color()}).then((function(){a.newRank.color(""),a.newRank.name(""),a.newRank.points(""),m.redraw()}))},n.changed=function(){var a=this,t=this.switches.some((function(t){return a.values[t]()!==("1"==u().data.settings[a.addPrefix(t)])}));return this.fields.some((function(t){return a.values[t]()!==u().data.settings[a.addPrefix(t)]}))||t},n.prepareSubmissionData=function(){var a=this,t={};return this.switches.forEach((function(n){return t[a.addPrefix(n)]=a.values[n]()})),this.fields.forEach((function(n){return t[a.addPrefix(n)]=a.values[n]()})),t},n.onsubmit=function(a){var t=this;a.preventDefault(),this.loading||(this.loading=!0,u().alerts.dismiss(this.successAlert),h()(this.prepareSubmissionData()).then(this.onsaved.bind(this)).then((function(){return window.location.reload()})).catch(console.error).then((function(){t.loading=!1})))},n.addPrefix=function(a){return this.settingsPrefix+"."+a},n.settingsItems=function(){var a=this,t=new(R());return t.add("convertLikesToUpvotes",m("div",null,m("div",{className:"helpText"},u().translator.trans("fof-gamification.admin.page.convert.help")),void 0===this.values.convertedLikes()?m(g(),{type:"button",className:"Button Button--warning Ranks-button","aria-label":u().translator.trans("fof-gamification.admin.page.convert.button"),onclick:function(){u().request({url:u().forum.attribute("apiUrl")+"/fof/gamification/convert",method:"POST"}).then(a.values.convertedLikes("converting"))}},u().translator.trans("fof-gamification.admin.page.convert.button")):"converting"===this.values.convertedLikes()?m("label",null,u().translator.trans("fof-gamification.admin.page.convert.converting")):m("label",null," ",u().translator.trans("fof-gamification.admin.page.convert.converted",{number:this.values.convertedLikes()}))),100),t.add("ranks",m("fieldset",{className:"SettingsPage-ranks"},m("legend",null,u().translator.trans("fof-gamification.admin.page.ranks.title")),m("label",null,u().translator.trans("fof-gamification.admin.page.ranks.ranks")),m("div",{className:"helpText"},u().translator.trans("fof-gamification.admin.page.ranks.help.help")),m("div",{className:"Ranks--Container"},this.ranks.map((function(t){return m("div",null,m("input",{className:"FormControl Ranks-number",type:"number",value:t.points(),placeholder:u().translator.trans("fof-gamification.admin.page.ranks.help.points"),oninput:y()("value",a.updatePoints.bind(a,t))}),m("input",{className:"FormControl Ranks-name",value:t.name(),placeholder:u().translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:y()("value",a.updateName.bind(a,t))}),m("input",{className:"FormControl Ranks-color",value:t.color(),placeholder:u().translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:y()("value",a.updateColor.bind(a,t))}),m(g(),{type:"button",className:"Button Button--warning Ranks-button",icon:"fa fa-times",onclick:a.deleteRank.bind(a,t)}))}))),m("div",null,m("input",{className:"FormControl Ranks-number",value:this.newRank.points(),placeholder:u().translator.trans("fof-gamification.admin.page.ranks.help.points"),type:"number",oninput:y()("value",this.newRank.points)}),m("input",{className:"FormControl Ranks-name",value:this.newRank.name(),placeholder:u().translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:y()("value",this.newRank.name)}),m("input",{className:"FormControl Ranks-color",value:this.newRank.color(),placeholder:u().translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:y()("value",this.newRank.color)}),m(g(),{type:"button",className:"Button Button--warning Ranks-button",icon:"fa fa-plus","aria-label":"add",onclick:this.addRank.bind(this)})),m("label",null,u().translator.trans("fof-gamification.admin.page.ranks.number_title")),m("input",{className:"FormControl Ranks-default",value:this.values.rankAmt(),type:"number",min:"0",oninput:y()("value",this.values.rankAmt)})),90),t.add("voteSettings",m("[",null,m("legend",null,u().translator.trans("fof-gamification.admin.page.votes.title")),this.voteItems().toArray()),80),t.add("rankingsPage",m("[",null,m("legend",null,u().translator.trans("fof-gamification.admin.page.rankings.title")),this.rankingsItems().toArray()),70),t.add("groups",m("fieldset",{className:"SettingsPage-groups"},m("legend",null,u().translator.trans("fof-gamification.admin.page.groups.title")),m("div",{className:"helpText"},u().translator.trans("fof-gamification.admin.page.groups.help")),m(T,{value:this.values.autoAssignedGroups(),onchange:this.values.autoAssignedGroups})),60),t.add("submit",m(g(),{type:"submit",className:"Button Button--primary Ranks-save",loading:this.loading,disabled:!this.changed()},u().translator.trans("fof-gamification.admin.page.save_settings")),0),t},n.voteItems=function(){var a=new(R());return a.add("icon",m("[",null,m("label",null,u().translator.trans("fof-gamification.admin.page.votes.icon_name")),m("div",{className:"helpText"},u().translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconName()||"",placeholder:"thumbs",oninput:y()("value",this.values.iconName)})),100),a.add("altIcon",m("[",null,m("label",null,u().translator.trans("fof-gamification.admin.page.alt_votes.icon_name")),m("div",{className:"helpText"},u().translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconNameAlt()||"",placeholder:"arrow",oninput:y()("value",this.values.iconNameAlt)})),90),a.add("autoUpvote",m(k(),{state:this.values.autoUpvotePosts()||!1,onchange:this.values.autoUpvotePosts,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.auto_upvote")),80),a.add("rateLimit",m(k(),{state:this.values.rateLimit()||!1,onchange:this.values.rateLimit,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.rate_limit")),70),a.add("opVotesOnDiscussionList",m(k(),{state:this.values.showVotesOnDiscussionPage()||!1,onchange:this.values.showVotesOnDiscussionPage,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.discussion_page")),60),a.add("altDiscussionListLayout",m(k(),{state:this.values.useAlternateLayout()||!1,onchange:this.values.useAlternateLayout,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.alternate_layout")),50),a.add("altPostLayout",m(k(),{state:this.values.altPostVotingUi()||!1,onchange:this.values.altPostVotingUi,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.alternate_post_layout")),40),a.add("upvotesOnly",m(k(),{state:this.values.upVotesOnly()||!1,onchange:this.values.upVotesOnly,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.upvotes_only")),30),a.add("firstPostOnly",m(k(),{state:this.values.firstPostOnly()||!1,onchange:this.values.firstPostOnly,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.first_post_only")),20),a.add("allowSelfVotes",m(k(),{state:this.values.allowSelfVotes(),onchange:this.values.allowSelfVotes,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.votes.allow_self_votes")),10),a},n.rankingsItems=function(){var a=new(R());return a.add("customImages",m(k(),{state:this.values.customRankingImages()||!1,onchange:this.values.customRankingImages,className:"votes-switch"},u().translator.trans("fof-gamification.admin.page.rankings.enable")),100),a.add("ignoredUsers",m("[",null,m("label",null,u().translator.trans("fof-gamification.admin.page.rankings.blocked.title")),m("input",{className:"FormControl Ranks-blocked",placeholder:u().translator.trans("fof-gamification.admin.page.rankings.blocked.placeholder"),value:this.values.blockedUsers()||"",oninput:y()("value",this.values.blockedUsers)})),90),a.add("customImages",m("[",null,m("div",{className:"helpText"},u().translator.trans("fof-gamification.admin.page.rankings.blocked.help")),[1,2,3].map((function(a){return m("[",null,m("label",{className:"Upload-label"},u().translator.trans("fof-gamification.admin.page.rankings.custom_image_"+a)),m(I,{className:"Upload-button",name:"fof-gamification.topimage"+a,path:"fof/gamification/topimage"+a,"aria-label":u().translator.trans("fof-gamification.admin.page.rankings.custom_image_"+a)}),m("br",null))}))),80),a},t}(p()),G={rankLabel:function(a,t){void 0===t&&(t={}),t.style=t.style||{},t.className="rankLabel "+(t.className||"");var n=a.color();return t.style.backgroundColor=t.style.color=n,t.className+=" colored",m("span",t,m("span",{className:"rankLabel-text"},a.name()))}},E={SettingsPage:F,UploadImageButton:I};u().initializers.add("fof-gamification",(function(a){a.store.models.ranks=r,a.extensionData.for("fof-gamification").registerPermission({icon:"fas fa-thumbs-up",label:a.translator.trans("fof-gamification.admin.permissions.vote_label"),permission:"discussion.votePosts"},"reply").registerPermission({icon:"fas fa-thumbs-up",label:a.translator.trans("fof-gamification.admin.permissions.see_votes_label"),permission:"discussion.canSeeVotes",allowGuest:!0},"view").registerPermission({icon:"fas fa-info-circle",label:a.translator.trans("fof-gamification.admin.permissions.see_voters_label"),permission:"discussion.canSeeVoters",allowGuest:!0},"view").registerPermission({icon:"fas fa-trophy",label:a.translator.trans("fof-gamification.admin.permissions.see_ranking_page"),permission:"fof.gamification.viewRankingPage",allowGuest:!0},"view").registerPermission({icon:"fas fa-bell",label:a.translator.trans("fof-gamification.admin.permissions.upvote_notifications"),permission:"discussion.upvote_notifications"},"view").registerPermission({icon:"fas fa-bell",label:a.translator.trans("fof-gamification.admin.permissions.downvote_notifications"),permission:"discussion.downvote_notifications"},"view").registerPage(F)}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map