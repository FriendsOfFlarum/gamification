module.exports=function(a){var t={};function n(e){if(t[e])return t[e].exports;var o=t[e]={i:e,l:!1,exports:{}};return a[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=a,n.c=t,n.d=function(a,t,e){n.o(a,t)||Object.defineProperty(a,t,{enumerable:!0,get:e})},n.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,t){if(1&t&&(a=n(a)),8&t)return a;if(4&t&&"object"==typeof a&&a&&a.__esModule)return a;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:a}),2&t&&"string"!=typeof a)for(var o in a)n.d(e,o,function(t){return a[t]}.bind(null,o));return e},n.n=function(a){var t=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(t,"a",t),t},n.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)},n.p="",n(n.s=48)}([function(a,t){a.exports=flarum.core.compat["common/Model"]},,function(a,t,n){"use strict";function e(a,t){return(e=Object.setPrototypeOf||function(a,t){return a.__proto__=t,a})(a,t)}function o(a,t){a.prototype=Object.create(t.prototype),a.prototype.constructor=a,e(a,t)}n.d(t,"a",(function(){return o}))},function(a,t){a.exports=flarum.core.compat["common/components/Button"]},function(a,t,n){"use strict";function e(a,t){void 0===t&&(t={}),t.style=t.style||{},t.className="rankLabel "+(t.className||"");var n=a.color();return t.style.backgroundColor=t.style.color=n,t.className+=" colored",m("span",t,m("span",{className:"rankLabel-text"},a.name()))}n.d(t,"a",(function(){return e}))},function(a,t){a.exports=flarum.core.compat["common/utils/Stream"]},function(a,t){a.exports=flarum.core.compat["common/utils/withAttr"]},function(a,t,n){"use strict";n.d(t,"a",(function(){return r}));var e=n(2),o=n(0),s=n.n(o),i=n(14),r=function(a){function t(){return a.apply(this,arguments)||this}return Object(e.a)(t,a),t}(n.n(i)()(s.a,{points:s.a.attribute("points"),name:s.a.attribute("name"),color:s.a.attribute("color"),groups:s.a.attribute("groups")}))},function(a,t){a.exports=flarum.core.compat["common/components/Switch"]},,,,function(a,t,n){"use strict";n.d(t,"a",(function(){return e}));var e={Rank:n(7).a}},function(a,t,n){"use strict";n.d(t,"a",(function(){return e}));var e={rankLabel:n(4).a}},function(a,t){a.exports=flarum.core.compat["common/utils/mixin"]},function(a,t){a.exports=flarum.core.compat["common/models/Group"]},,,,,,,function(a,t){a.exports=flarum.core.compat["common/components/Select"]},,,,,,,,,,,,,,,,,,,function(a,t){a.exports=flarum.core.compat["admin/app"]},function(a,t){a.exports=flarum.core.compat["admin/components/ExtensionPage"]},function(a,t){a.exports=flarum.core.compat["admin/utils/saveSettings"]},function(a,t){a.exports=flarum.core.compat["admin/components/UploadImageButton"]},function(a,t){a.exports=flarum.core.compat["common/components/GroupBadge"]},,,function(a,t,n){"use strict";n.r(t),n.d(t,"models",(function(){return e.a})),n.d(t,"helpers",(function(){return j.a})),n.d(t,"components",(function(){return B}));var e=n(12),o=n(41),s=n.n(o),i=n(2),r=n(42),l=n.n(r),c=n(3),p=n.n(c),u=n(43),f=n.n(u),d=n(8),g=n.n(d),h=n(6),v=n.n(h),k=n(5),b=n.n(k),y=n(44),R=function(a){function t(){return a.apply(this,arguments)||this}return Object(i.a)(t,a),t.prototype.resourceUrl=function(){return app.forum.attribute("apiUrl")+"/"+this.attrs.path},t}(n.n(y).a),w=n(22),N=n.n(w),x=n(45),P=n.n(x),_=function(a){function t(){return a.apply(this,arguments)||this}Object(i.a)(t,a);var n=t.prototype;return n.oninit=function(t){var n=this;a.prototype.oninit.call(this,t),this.fields=["convertedLikes","amountPerPost","amountPerDiscussion","postStartAmount","rankAmt","iconName","blockedUsers","pointsPlaceholder"],this.switches=["autoUpvotePosts","customRankingImages","rateLimit","showVotesOnDiscussionPage","useAlternateLayout","allowSelfVote","onlyOneStickyRank"],this.ranks=app.store.all("ranks"),this.values={},this.settingsPrefix="fof-gamification";var e=app.data.settings;this.fields.forEach((function(a){return n.values[a]=b()(e[n.addPrefix(a)])})),this.switches.forEach((function(a){return n.values[a]=b()(!!Number(e[n.addPrefix(a)]))})),this.newRank={points:b()(""),name:b()(""),color:b()(""),groups:b()(""),sticky_group:b()("")}},n.content=function(){var a=this,t={null:null};app.store.all("groups").forEach((function(a){return t[parseInt(a.id())]=a.nameSingular()}));var n={null:null};return this.ranks.forEach((function(a){return n[parseInt(a.id())]=a.name()})),[m("div",{className:"SettingsPage"},[m("div",{className:"container"},[m("form",{onsubmit:this.onsubmit.bind(this)},[m("div",{className:"helpText"},app.translator.trans("fof-gamification.admin.page.convert.help")),void 0===this.values.convertedLikes()?p.a.component({type:"button",className:"Button Button--warning Ranks-button",onclick:function(){app.request({url:app.forum.attribute("apiUrl")+"/fof/gamification/convert",method:"POST"}).then(a.values.convertedLikes("converting"))}},app.translator.trans("fof-gamification.admin.page.convert.button")):"converting"===this.values.convertedLikes()?m("label",{},app.translator.trans("fof-gamification.admin.page.convert.converting")):m("label",{},app.translator.trans("fof-gamification.admin.page.convert.converted",{number:this.values.convertedLikes()})),m("fieldset",{className:"SettingsPage-ranks"},[m("legend",{},app.translator.trans("fof-gamification.admin.page.ranks.title")),m("label",{},app.translator.trans("fof-gamification.admin.page.ranks.ranks")),m("div",{className:"helpText"},app.translator.trans("fof-gamification.admin.page.ranks.help.help")),m("div",{className:"Ranks--Container"},this.ranks.map((function(n){return m("div",{style:"float: left;"},[m("input",{className:"FormControl Ranks-number",type:"number",value:n.points(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.points"),oninput:v()("value",a.updatePoints.bind(a,n))}),m("input",{className:"FormControl Ranks-name",value:n.name(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:v()("value",a.updateName.bind(a,n))}),m("input",{className:"FormControl Ranks-color",value:n.color(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:v()("value",a.updateColor.bind(a,n))}),N.a.component({className:"FormControl Ranks-group",options:t,value:Array.isArray(n.groups())?n.groups()[0]:n.groups(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.group"),onchange:a.updateGroups.bind(a,n)}),p.a.component({type:"button",className:"Button Button--warning Ranks-button",icon:"fa fa-times",onclick:a.deleteRank.bind(a,n)})])})),m("div",{style:"float: left; margin-bottom: 15px"},[m("input",{className:"FormControl Ranks-number",value:this.newRank.points(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.points"),type:"number",oninput:v()("value",this.newRank.points)}),m("input",{className:"FormControl Ranks-name",value:this.newRank.name(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:v()("value",this.newRank.name)}),m("input",{className:"FormControl Ranks-color",value:this.newRank.color(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:v()("value",this.newRank.color)}),N.a.component({className:"FormControl Ranks-group",options:t,value:this.newRank.groups(),placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.group"),onChange:this.newRank.groups}),p.a.component({type:"button",className:"Button Button--warning Ranks-button",icon:"fa fa-plus",onclick:this.addRank.bind(this)})])),m("legend",{},app.translator.trans("fof-gamification.admin.page.sticky-ranks.title")),m("label",{},app.translator.trans("fof-gamification.admin.page.sticky-ranks.label")),m("div",{className:"helpText"},app.translator.trans("fof-gamification.admin.page.sticky-ranks.help")),m("table",{className:"Ranks--Container"},app.store.all("groups").map((function(t){return[m("tr",[m("td",P.a.component({group:t})),m("td",m("b",{className:"Ranks-group",style:"margin-right: 8px; margin-left: 5px;"},""+t.nameSingular())),m("td",N.a.component({className:"FormControl Ranks-name",options:n,value:t.sticky_rank()?t.sticky_rank().id():"",placeholder:app.translator.trans("fof-gamification.admin.page.ranks.help.name"),onchange:a.updateStickyRank.bind(a,t)}))]),m("tr",{style:"height: 8px;"})]}))),g.a.component({state:this.values.onlyOneStickyRank(),onchange:this.values.onlyOneStickyRank,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.sticky-ranks.only_one_sticky_rank")),m("label",{},app.translator.trans("fof-gamification.admin.page.ranks.number_title")),m("input",{className:"FormControl Ranks-default",value:this.values.rankAmt()||"",placeholder:2,oninput:v()("value",this.values.rankAmt)}),m("legend",{},app.translator.trans("fof-gamification.admin.page.votes.title")),m("label",{},app.translator.trans("fof-gamification.admin.page.votes.icon_name")),m("div",{className:"helpText"},app.translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconName()||"",placeholder:"thumbs",oninput:v()("value",this.values.iconName)}),g.a.component({state:this.values.allowSelfVote(),onchange:this.values.allowSelfVote,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.votes.allow_selfvote")),g.a.component({state:this.values.autoUpvotePosts()||!1,onchange:this.values.autoUpvotePosts,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.votes.auto_upvote")),g.a.component({state:this.values.rateLimit()||!1,onchange:this.values.rateLimit,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.votes.rate_limit")),g.a.component({state:this.values.showVotesOnDiscussionPage()||!1,onchange:this.values.showVotesOnDiscussionPage,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.votes.discussion_page")),g.a.component({state:this.values.useAlternateLayout()||!1,onchange:this.values.useAlternateLayout,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.votes.alternate_layout")),m("label",{},app.translator.trans("fof-gamification.admin.page.votes.points_title")),m("input",{className:"FormControl Ranks-default",value:this.values.pointsPlaceholder()||"",placeholder:app.translator.trans("fof-gamification.admin.page.votes.points_placeholder")+"{points}",oninput:v()("value",this.values.pointsPlaceholder)}),m("legend",{},app.translator.trans("fof-gamification.admin.page.rankings.title")),g.a.component({state:this.values.customRankingImages()||!1,onchange:this.values.customRankingImages,className:"votes-switch"},app.translator.trans("fof-gamification.admin.page.rankings.enable")),m("label",{},app.translator.trans("fof-gamification.admin.page.rankings.blocked.title")),m("input",{className:"FormControl Ranks-blocked",placeholder:app.translator.trans("fof-gamification.admin.page.rankings.blocked.placeholder"),value:this.values.blockedUsers()||"",oninput:v()("value",this.values.blockedUsers)}),m("div",{className:"helpText"},app.translator.trans("fof-gamification.admin.page.rankings.blocked.help"))].concat([1,2,3].map((function(a){return[m("label",{className:"Upload-label"},app.translator.trans("fof-gamification.admin.page.rankings.custom_image_"+a)),m(R,{className:"Upload-button",name:"fof-gamification.topimage"+a,path:"fof/gamification/topimage"+a}),m("br",null)]})),[p.a.component({type:"submit",className:"Button Button--primary Ranks-save",loading:this.loading,disabled:!this.changed()},app.translator.trans("fof-gamification.admin.page.save_settings"))]))])])])]},n.updateName=function(a,t){a.save({name:t})},n.updatePoints=function(a,t){a.save({points:t})},n.updateColor=function(a,t){a.save({color:t})},n.updateGroups=function(a,t){a.save({groups:t})},n.updateStickyRank=function(a,t){var n,e={data:[]};a.save({relationships:{sticky_rank:t&&null!=(n=app.store.getById("ranks",t))?n:e}})},n.deleteRank=function(a){var t=this;a.delete(),this.ranks.some((function(n,e){if(n.data.id===a.data.id)return t.ranks.splice(e,1),!0}))},n.addRank=function(a){var t=this;app.store.createRecord("ranks").save({points:this.newRank.points(),name:this.newRank.name(),color:this.newRank.color(),groups:this.newRank.groups()}).then((function(a){t.newRank.color(""),t.newRank.name(""),t.newRank.points(""),t.newRank.groups(""),t.ranks.push(a),m.redraw()}))},n.changed=function(){var a=this,t=this.switches.some((function(t){return a.values[t]()!==("1"==app.data.settings[a.addPrefix(t)])}));return this.fields.some((function(t){return a.values[t]()!==app.data.settings[a.addPrefix(t)]}))||t},n.onsubmit=function(a){var t=this;if(a.preventDefault(),!this.loading){this.loading=!0,app.alerts.dismiss(this.successAlert);var n={};this.switches.forEach((function(a){return n[t.addPrefix(a)]=t.values[a]()})),this.fields.forEach((function(a){return n[t.addPrefix(a)]=t.values[a]()})),f()(n).then((function(){app.alerts.show({type:"success"},app.translator.trans("core.admin.basics.saved_message"))})).catch((function(){})).then((function(){t.loading=!1,window.location.reload()}))}},n.addPrefix=function(a){return this.settingsPrefix+"."+a},t}(l.a),S=n(0),O=n.n(S),C=n(7),L=n(15),F=n.n(L),j=n(13),B={SettingsPage:_};s.a.initializers.add("fof-gamification",(function(a){a.store.models.ranks=C.a,F.a.prototype.sticky_rank=O.a.hasOne("sticky_rank"),a.extensionData.for("fof-gamification").registerPermission({icon:"fas fa-thumbs-up",label:a.translator.trans("fof-gamification.admin.permissions.vote_label"),permission:"discussion.votePosts"},"reply").registerPermission({icon:"fas fa-info-circle",label:a.translator.trans("fof-gamification.admin.permissions.see_votes_label"),permission:"discussion.canSeeVotes"},"view").registerPermission({icon:"fas fa-trophy",label:a.translator.trans("fof-gamification.admin.permissions.see_ranking_page"),permission:"fof.gamification.viewRankingPage"},"view").registerPage(_)}))}]);
//# sourceMappingURL=admin.js.map