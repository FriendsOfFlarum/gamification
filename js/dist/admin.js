(()=>{var a={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return a.d(n,{a:n}),n},d:(t,n)=>{for(var e in n)a.o(n,e)&&!a.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},o:(a,t)=>Object.prototype.hasOwnProperty.call(a,t),r:a=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}},t={};(()=>{"use strict";a.r(t),a.d(t,{extend:()=>aa});const n=flarum.reg.get("core","admin/app");var e=a.n(n);const s=flarum.reg.get("core","common/extenders");var o=a.n(s);const i=flarum.reg.get("core","common/Model");var r=a.n(i);class l extends(r()){points(){return r().attribute("points").call(this)}name(){return r().attribute("name").call(this)}color(){return r().attribute("color").call(this)}}flarum.reg.add("fof-gamification","common/models/Rank",l);const c=flarum.reg.get("core","common/app");var u=a.n(c);const f=flarum.reg.get("core","common/query/IGambit");class d extends f.BooleanGambit{key(){return u().translator.trans("fof-gamification.lib.gambits.hot.key",{},!0)}filterKey(){return"hot"}}flarum.reg.add("fof-gamification","common/gambits/HotGambit",d);const p=[(new(o().Store)).add("ranks",l),(new(o().Search)).gambit("discussions",d)],g=flarum.reg.get("core","admin/components/ExtensionPage");var v=a.n(g);const h=flarum.reg.get("core","common/components/Button");var b=a.n(h);const w=flarum.reg.get("core","admin/utils/saveSettings");var k=a.n(w);const N=flarum.reg.get("core","common/components/Switch");var y=a.n(N);const P=flarum.reg.get("core","common/utils/withAttr");var S=a.n(P);const _=flarum.reg.get("core","common/utils/Stream");var I=a.n(_);const R=flarum.reg.get("core","common/utils/ItemList");var x=a.n(R);const F=flarum.reg.get("core","common/components/Form");var A=a.n(F);const G=flarum.reg.get("core","admin/components/FormSection");var O=a.n(G);const C=flarum.reg.get("core","admin/components/FormSectionGroup");var U=a.n(C);const B=flarum.reg.get("core","common/components/UploadImageButton");var L=a.n(B);class M extends(L()){resourceUrl(){return e().forum.attribute("apiUrl")+"/"+this.attrs.path}}function V(a){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},V(a)}function T(a,t,n){return(t=function(a){var t=function(a){if("object"!=V(a)||!a)return a;var t=a[Symbol.toPrimitive];if(void 0!==t){var n=t.call(a,"string");if("object"!=V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(a);return"symbol"==V(t)?t:t+""}(t))in a?Object.defineProperty(a,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[t]=n,a}flarum.reg.add("fof-gamification","admin/components/UploadImageButton",M);const D=flarum.reg.get("core","common/Component");var E=a.n(D);const $=flarum.reg.get("core","common/components/Select");var j=a.n($);const J=flarum.reg.get("core","common/components/Tooltip");var q=a.n(J);const z=flarum.reg.get("core","common/utils/extractText");var H=a.n(z);const K=flarum.reg.get("core","common/models/Group");var Q=a.n(K);class W extends(E()){constructor(){super(...arguments),T(this,"newGroupId",I()("")),T(this,"newMinPoints",I()("")),T(this,"newMaxPoints",I()(""))}view(){let a=[];try{a=JSON.parse(this.attrs.value)}catch(a){}Array.isArray(a)||(a=[]);let t={};return e().store.all("groups").forEach((a=>{-1===[Q().ADMINISTRATOR_ID,Q().MEMBER_ID,Q().GUEST_ID].indexOf(a.id())&&(t[a.id()]=a.nameSingular())})),m("table",null,m("thead",null,m("tr",null,m("th",null,e().translator.trans("fof-gamification.admin.page.groups.column.group")),m("th",null,e().translator.trans("fof-gamification.admin.page.groups.column.minPoints")),m("th",null,e().translator.trans("fof-gamification.admin.page.groups.column.maxPoints")))),m("tbody",null,a.map(((n,s)=>{const o=t=>e=>{""===e?delete n[t]:n[t]=parseInt(e),this.attrs.onchange(JSON.stringify(a))};return m("tr",null,m("td",null,m(j(),{options:t,value:n.groupId+"",onchange:o("groupId")})),m("td",null,m("input",{className:"FormControl",type:"number",value:n.minPoints||"",onchange:S()("value",o("minPoints"))})),m("td",null,m("input",{className:"FormControl",type:"number",value:n.maxPoints||"",onchange:S()("value",o("maxPoints"))})),m("td",null,m(q(),{text:H()(e().translator.trans("fof-gamification.admin.page.groups.delete"))},m(b(),{className:"Button Button--icon",icon:"fas fa-times",onclick:()=>{a.splice(s,1),this.attrs.onchange(JSON.stringify(a))}},"Delete"))))})),m("tr",null,m("td",null,m(j(),{options:t,value:this.newGroupId(),onchange:this.newGroupId})),m("td",null,m("input",{className:"FormControl",type:"number",bidi:this.newMinPoints})),m("td",null,m("input",{className:"FormControl",type:"number",bidi:this.newMaxPoints})),m("td",null,m(q(),{text:H()(e().translator.trans("fof-gamification.admin.page.groups.add"))},m(b(),{className:"Button Button--icon",icon:"fas fa-plus",onclick:()=>{const t={groupId:parseInt(this.newGroupId())};this.newMinPoints()&&(t.minPoints=parseInt(this.newMinPoints())),this.newMaxPoints()&&(t.maxPoints=parseInt(this.newMaxPoints())),a.push(t),this.attrs.onchange(JSON.stringify(a)),this.newGroupId(""),this.newMinPoints(""),this.newMaxPoints("")},disabled:!this.newGroupId()},"Add"))))))}}flarum.reg.add("fof-gamification","admin/components/GroupSettings",W);const X=flarum.reg.get("core","common/components/Icon");var Y=a.n(X);class Z extends(v()){oninit(a){super.oninit(a),this.fields=["convertedLikes","amountPerPost","amountPerDiscussion","postStartAmount","rankAmt","iconName","blockedUsers","iconNameAlt","autoAssignedGroups"],this.switches=["autoUpvotePosts","customRankingImages","rateLimit","showVotesOnDiscussionPage","useAlternateLayout","altPostVotingUi","upVotesOnly","firstPostOnly","allowSelfVotes"],this.ranks=e().store.all("ranks"),this.values={},this.settingsPrefix="fof-gamification";const t=e().data.settings;this.fields.forEach((a=>this.values[a]=I()(t[this.addPrefix(a)]))),this.switches.forEach((a=>this.values[a]=I()(!!Number(t[this.addPrefix(a)])))),this.newRank={points:I()(""),name:I()(""),color:I()("")}}content(){return m("div",{className:"SettingsPage"},m("div",{className:"container"},m("form",{onsubmit:this.onsubmit.bind(this)},this.settingsItems().toArray())))}updateName(a,t){a.save({name:t})}updatePoints(a,t){a.save({points:t})}updateColor(a,t){a.save({color:t})}deleteRank(a){a.delete(),this.ranks.some(((t,n)=>{if(t.data.id===a.data.id)return this.ranks.splice(n,1),!0}))}addRank(){e().store.createRecord("ranks").save({points:this.newRank.points(),name:this.newRank.name(),color:this.newRank.color()}).then((a=>{this.newRank.color(""),this.newRank.name(""),this.newRank.points(""),this.ranks.push(a),m.redraw()}))}changed(){var a=this.switches.some((a=>this.values[a]()!==("1"==e().data.settings[this.addPrefix(a)])));return this.fields.some((a=>this.values[a]()!==e().data.settings[this.addPrefix(a)]))||a}prepareSubmissionData(){const a={};return this.switches.forEach((t=>a[this.addPrefix(t)]=this.values[t]())),this.fields.forEach((t=>a[this.addPrefix(t)]=this.values[t]())),a}onsubmit(a){a.preventDefault(),this.loading||(this.loading=!0,e().alerts.dismiss(this.successAlert),k()(this.prepareSubmissionData()).then(this.onsaved.bind(this)).then((()=>window.location.reload())).catch(console.error).then((()=>{this.loading=!1})))}addPrefix(a){return this.settingsPrefix+"."+a}settingsItems(){const a=new(x());return a.add("convertLikesToUpvotes",m("div",{className:"Form-group"},m("div",{className:"helpText"},e().translator.trans("fof-gamification.admin.page.convert.help")),void 0===this.values.convertedLikes()?m(b(),{type:"button",className:"Button Button--warning Ranks-button","aria-label":e().translator.trans("fof-gamification.admin.page.convert.button"),onclick:()=>{e().request({url:e().forum.attribute("apiUrl")+"/fof/gamification/convert",method:"POST"}).then(this.values.convertedLikes("converting"))}},e().translator.trans("fof-gamification.admin.page.convert.button")):"converting"===this.values.convertedLikes()?m("label",null,e().translator.trans("fof-gamification.admin.page.convert.converting")):m("label",null," ",e().translator.trans("fof-gamification.admin.page.convert.converted",{number:this.values.convertedLikes()}))),100),a.add("firstSectionGroup",m(U(),null,this.firstSectionGroupItems().toArray()),80),a.add("secondSectionGroup",m(U(),null,this.secondSectionGroupItems().toArray()),70),a.add("submit",m(b(),{type:"submit",className:"Button Button--primary Ranks-save",loading:this.loading,disabled:!this.changed()},e().translator.trans("fof-gamification.admin.page.save_settings")),0),a}firstSectionGroupItems(){const a=new(x());return a.add("ranks",m(O(),{label:e().translator.trans("fof-gamification.admin.page.ranks.title"),className:"SettingsPage-ranks"},m(A(),null,this.rankItems().toArray())),90),a.add("voteSettings",m(O(),{label:e().translator.trans("fof-gamification.admin.page.votes.title")},m(A(),null,this.voteItems().toArray())),80),a}secondSectionGroupItems(){const a=new(x());return a.add("rankingsPage",m(O(),{label:e().translator.trans("fof-gamification.admin.page.rankings.title")},this.rankingsItems().toArray()),70),a.add("groups",m(O(),{label:e().translator.trans("fof-gamification.admin.page.groups.title"),className:"SettingsPage-groups"},m("div",{className:"helpText"},e().translator.trans("fof-gamification.admin.page.groups.help")),m(W,{value:this.values.autoAssignedGroups(),onchange:this.values.autoAssignedGroups})),60),a}rankItems(){const a=new(x());return a.add("ranks",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-gamification.admin.page.ranks.ranks")),m("div",{className:"helpText"},e().translator.trans("fof-gamification.admin.page.ranks.help.help")),this.ranks.length>0?m("div",{className:"Ranks--Container"},this.ranks.map((a=>m("div",{className:"Ranks--Container-row"},m("input",{className:"FormControl Ranks-number",type:"number",value:a.points(),placeholder:e().translator.trans("fof-gamification.admin.page.ranks.help.points"),oninput:S()("value",this.updatePoints.bind(this,a))}),m("input",{className:"FormControl Ranks-name",value:a.name(),placeholder:e().translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:S()("value",this.updateName.bind(this,a))}),m("input",{className:"FormControl Ranks-color",value:a.color(),placeholder:e().translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:S()("value",this.updateColor.bind(this,a))}),m(b(),{type:"button",className:"Button Button--warning Button--icon Ranks-button",icon:"fa fa-times",onclick:this.deleteRank.bind(this,a)}))))):null,m("div",{className:"Ranks--Container-row"},m("input",{className:"FormControl Ranks-number",value:this.newRank.points(),placeholder:e().translator.trans("fof-gamification.admin.page.ranks.help.points"),type:"number",oninput:S()("value",this.newRank.points)}),m("input",{className:"FormControl Ranks-name",value:this.newRank.name(),placeholder:e().translator.trans("fof-gamification.admin.page.ranks.help.name"),oninput:S()("value",this.newRank.name)}),m("input",{className:"FormControl Ranks-color",value:this.newRank.color(),placeholder:e().translator.trans("fof-gamification.admin.page.ranks.help.color"),oninput:S()("value",this.newRank.color)}),m(b(),{type:"button",className:"Button Button--primary Button--icon Ranks-button",icon:"fa fa-plus","aria-label":"add",onclick:this.addRank.bind(this)}))),100),a.add("rankNumbers",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-gamification.admin.page.ranks.number_title")),m("input",{className:"FormControl Ranks-default",value:this.values.rankAmt(),type:"number",min:"0",oninput:S()("value",this.values.rankAmt)})),80),a}voteItems(){const a=new(x());return a.add("icon",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-gamification.admin.page.votes.icon_name")),m("div",{className:"helpText"},e().translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconName()||"",oninput:S()("value",this.values.iconName)}),this.values.iconName()&&m("div",{className:"IconPreview"},m("span",null,m(Y(),{name:`fas fa-fw fa-${this.values.iconName()}-up`}),m("span",null,e().translator.trans("fof-gamification.admin.page.votes.icon_preview_upvote"))),m("span",null,m(Y(),{name:`fas fa-fw fa-${this.values.iconName()}-down`}),m("span",null,e().translator.trans("fof-gamification.admin.page.votes.icon_preview_downvote"))))),100),a.add("altIcon",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-gamification.admin.page.alt_votes.icon_name")),m("div",{className:"helpText"},e().translator.trans("fof-gamification.admin.page.votes.icon_help")),m("input",{className:"FormControl Ranks-default",value:this.values.iconNameAlt()||"",oninput:S()("value",this.values.iconNameAlt)}),this.values.iconNameAlt()&&m("div",{className:"IconPreview"},m("span",null,m(Y(),{name:`fas fa-fw fa-${this.values.iconNameAlt()}-up`}),m("span",null,e().translator.trans("fof-gamification.admin.page.votes.icon_preview_upvote"))),m("span",null,m(Y(),{name:`fas fa-fw fa-${this.values.iconNameAlt()}-down`}),m("span",null,e().translator.trans("fof-gamification.admin.page.votes.icon_preview_downvote"))))),90),a.add("autoUpvote",m("div",{className:"Form-group"},m(y(),{state:this.values.autoUpvotePosts()||!1,onchange:this.values.autoUpvotePosts,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.auto_upvote"))),80),a.add("rateLimit",m("div",{className:"Form-group"},m(y(),{state:this.values.rateLimit()||!1,onchange:this.values.rateLimit,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.rate_limit"))),70),a.add("opVotesOnDiscussionList",m("div",{className:"Form-group"},m(y(),{state:this.values.showVotesOnDiscussionPage()||!1,onchange:this.values.showVotesOnDiscussionPage,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.discussion_page"))),60),a.add("altDiscussionListLayout",m("div",{className:"Form-group"},m(y(),{state:this.values.useAlternateLayout()||!1,onchange:this.values.useAlternateLayout,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.alternate_layout"))),50),a.add("altPostLayout",m("div",{className:"Form-group"},m(y(),{state:this.values.altPostVotingUi()||!1,onchange:this.values.altPostVotingUi,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.alternate_post_layout"))),40),a.add("upvotesOnly",m("div",{className:"Form-group"},m(y(),{state:this.values.upVotesOnly()||!1,onchange:this.values.upVotesOnly,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.upvotes_only"))),30),a.add("firstPostOnly",m("div",{className:"Form-group"},m(y(),{state:this.values.firstPostOnly()||!1,onchange:this.values.firstPostOnly,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.first_post_only"))),20),a.add("allowSelfVotes",m("div",{className:"Form-group"},m(y(),{state:this.values.allowSelfVotes(),onchange:this.values.allowSelfVotes,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.votes.allow_self_votes"))),10),a}rankingsItems(){const a=new(x());return a.add("customImages",m("div",{className:"Form-group"},m(y(),{state:this.values.customRankingImages()||!1,onchange:this.values.customRankingImages,className:"votes-switch"},e().translator.trans("fof-gamification.admin.page.rankings.enable"))),100),a.add("ignoredUsers",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-gamification.admin.page.rankings.blocked.title")),m("input",{className:"FormControl Ranks-blocked",placeholder:e().translator.trans("fof-gamification.admin.page.rankings.blocked.placeholder"),value:this.values.blockedUsers()||"",oninput:S()("value",this.values.blockedUsers)})),90),a.add("customImages",m("[",null,[1,2,3].map((a=>m("div",{className:"Form-group"},m("label",{className:"Upload-label"},e().translator.trans(`fof-gamification.admin.page.rankings.custom_image_${a}`)),m(M,{className:"Upload-button",name:`fof-gamification.topimage${a}`,path:`fof/gamification/topimage${a}`,"aria-label":e().translator.trans(`fof-gamification.admin.page.rankings.custom_image_${a}`)}),m("br",null))))),80),a}}flarum.reg.add("fof-gamification","admin/components/SettingsPage",Z);const aa=[...p,(new(o().Admin)).page(Z).permission((()=>({icon:"fas fa-thumbs-up",label:e().translator.trans("fof-gamification.admin.permissions.vote_label"),permission:"discussion.votePosts"})),"reply").permission((()=>({icon:"fas fa-thumbs-up",label:e().translator.trans("fof-gamification.admin.permissions.see_votes_label"),permission:"discussion.canSeeVotes",allowGuest:!0})),"view").permission((()=>({icon:"fas fa-info-circle",label:e().translator.trans("fof-gamification.admin.permissions.see_voters_label"),permission:"discussion.canSeeVoters",allowGuest:!0})),"view").permission((()=>({icon:"fas fa-trophy",label:e().translator.trans("fof-gamification.admin.permissions.see_ranking_page"),permission:"fof.gamification.viewRankingPage",allowGuest:!0})),"view").permission((()=>({icon:"fas fa-bell",label:e().translator.trans("fof-gamification.admin.permissions.upvote_notifications"),permission:"discussion.upvote_notifications"})),"view").permission((()=>({icon:"fas fa-bell",label:e().translator.trans("fof-gamification.admin.permissions.downvote_notifications"),permission:"discussion.downvote_notifications"})),"view")];e().initializers.add("fof-gamification",(()=>{}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map