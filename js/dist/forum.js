module.exports=function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=37)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat.extend},function(t,n){t.exports=flarum.core.compat.Model},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n,e){"use strict";function r(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}e.d(n,"a",function(){return r})},function(t,n){t.exports=flarum.core.compat["components/IndexPage"]},function(t,n){},function(t,n,e){"use strict";e.d(n,"a",function(){return i});var r=e(4),o=e(2),s=e.n(o),a=e(8),i=function(t){function n(){return t.apply(this,arguments)||this}return Object(r.a)(n,t),n}(e.n(a)()(s.a,{points:s.a.attribute("points"),name:s.a.attribute("name"),color:s.a.attribute("color")}))},function(t,n){t.exports=flarum.core.compat["utils/mixin"]},function(t,n){t.exports=flarum.core.compat["components/Page"]},function(t,n){t.exports=flarum.core.compat["components/LogInModal"]},function(t,n){t.exports=flarum.core.compat["helpers/avatar"]},function(t,n){t.exports=flarum.core.compat["helpers/username"]},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n){t.exports=flarum.core.compat["models/Discussion"]},,function(t,n){t.exports=flarum.core.compat["models/Post"]},function(t,n){t.exports=flarum.core.compat["models/User"]},function(t,n){t.exports=flarum.core.compat["components/UserCard"]},function(t,n){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,n){t.exports=flarum.core.compat["components/CommentPost"]},,,function(t,n,e){"use strict";var r=e(1),o=e(0),s=e.n(o),a=e(14),i=e.n(a),u=e(2),c=e.n(u),p=e(16),f=e.n(p),l=e(25),d=e.n(l),h=e(17),b=e.n(h),g=e(18),v=e.n(g);function y(t,n){void 0===n&&(n={}),n.style=n.style||{},n.className="rankLabel "+(n.className||"");var e=t.color();return n.style.backgroundColor=n.style.color=e,n.className+=" colored",m("span",n,m("span",{className:"rankLabel-text"},t.name()))}var k=function(){i.a.prototype.canVote=c.a.attribute("canVote"),i.a.prototype.canSeeVotes=c.a.attribute("canSeeVotes"),i.a.prototype.votes=c.a.attribute("votes"),b.a.prototype.points=c.a.attribute("points"),b.a.prototype.ranks=c.a.hasMany("ranks"),f.a.prototype.upvotes=c.a.hasMany("upvotes"),f.a.prototype.downvotes=c.a.hasMany("downvotes");var t=function(t){return function(n){return n&&n.attrs&&n.attrs.className&&n.attrs.className===t}};Object(r.extend)(v.a.prototype,"infoItems",function(t,n){var e="";0==e&&(e="0"),e=app.forum.attribute("PointsPlaceholder")?app.forum.attribute("PointsPlaceholder").replace("{points}",this.props.user.data.attributes.Points):app.translator.trans("reflar-gamification.forum.user.points",{points:this.props.user.data.attributes.Points}),t.add("points",e)}),Object(r.extend)(v.a.prototype,"view",function(n){var e=this.props.user,r=function n(e,r){var o=[];if(e.children){var s=e.children.find(t(r));void 0!==s&&(o=o.concat(s)),e.children.forEach(function(t){o=o.concat(n(t,r))})}return o}(n,"UserCard-profile")[0],o=r.children.find(t("UserCard-badges"));return e.ranks()&&(void 0===o||""===o?r.children.splice(1,0,m("ul",{className:"UserCard-badges badges"},e.ranks().reverse().map(function(t,n){if(!(n>=app.forum.attribute("ranksAmt")&&null!==app.forum.attribute("ranksAmt")))return m("li",{className:"User-Rank"},y(t))}))):o.children.push(e.ranks().reverse().map(function(t,n){if(!(n>=app.forum.attribute("ranksAmt")&&null!==app.forum.attribute("ranksAmt")))return m("li",{className:"User-Rank"},y(t))}))),n}),Object(r.extend)(d.a.prototype,"view",function(t){var n,e=this.props.post.user();return e?(t.children.find((n="h3",function(t){return t&&t.tag&&t.tag===n})).children.push(e.ranks().reverse().map(function(t,n){if(!(n>=app.forum.attribute("ranksAmt")&&null!==app.forum.attribute("ranksAmt")))return m("span",{className:"Post-Rank"},y(t))})),t):t})},x=e(5),N=e.n(x),P=e(13),O=e.n(P),j=e(19),V=e.n(j),I=e(26),M=e.n(I),w=e(3),C=e.n(w),R=e(27),S=e.n(R),L=function(){N.a.prototype.viewItems=function(){var t=this,n=new O.a,e=app.cache.discussionList.sortMap(),r={};for(var o in e)r[o]=app.translator.trans("core.forum.index_sort."+o+"_button");var s=r[this.params().sort]||Object.keys(e).map(function(t){return r[t]})[0];return/^.*?\/hot/.test(m.route())&&(s=app.translator.trans("core.forum.index_sort.hot_button")),n.add("sort",M.a.component({buttonClassName:"Button",label:s,children:Object.keys(r).map(function(n){var o=r[n],s=(t.params().sort||Object.keys(e)[0])===n;return/^.*?\/hot/.test(m.route())&&"hot"===n&&(s=!0),/^.*?\/hot/.test(m.route())&&"latest"===n&&(s=!1,m.redraw()),C.a.component({children:o,icon:!s||"fas fa-check",onclick:t.changeSort.bind(t,n),active:s})})})),n},Object(r.extend)(N.a.prototype,"navItems",function(t){t.add("rankings",S.a.component({href:app.route("rankings"),children:app.translator.trans("reflar-gamification.forum.nav.name"),icon:"fas fa-trophy"}),80)}),N.a.prototype.changeSort=function(t){var n=this.params();"hot"===t?(m.route("/"),m.route(m.route()+"hot")):(t===Object.keys(app.cache.discussionList.sortMap())[0]?delete n.sort:n.sort=t,"hot"===n.filter&&delete n.filter,m.route(app.route("index",n)))},Object(r.extend)(V.a.prototype,"sortMap",function(t){t.hot="hot"}),Object(r.extend)(V.a.prototype,"requestParams",function(t){"hot"===this.props.params.filter&&(t.filter.q=" is:hot")})},A=e(10),B=e.n(A),q=e(20),T=e.n(q),z=e(28),F=e.n(z),U=e(4),E=e(29),G=e.n(E),H=e(11),J=e.n(H),K=e(12),Q=e.n(K),W=function(t){function n(){return t.apply(this,arguments)||this}Object(U.a)(n,t);var e=n.prototype;return e.className=function(){return"VotesModal Modal--small"},e.title=function(){return app.translator.trans("reflar-gamification.forum.modal.title")},e.content=function(){return m("div",{className:"Modal-body"},m("ul",{className:"VotesModal-list"},m("legend",null,app.translator.trans("reflar-gamification.forum.modal.upvotes_label")),this.props.post.upvotes().map(function(t){return m("li",null,m("a",{href:app.route.user(t),config:m.route},J()(t)," "," ",Q()(t)))}),m("legend",null,app.translator.trans("reflar-gamification.forum.modal.downvotes_label")),this.props.post.downvotes().map(function(t){return m("li",null,m("a",{href:app.route.user(t),config:m.route},J()(t)," "," ",Q()(t)))})))},n}(G.a),X=e(7),Y=e(9),Z=e.n(Y),$=e(30),D=e.n($),_=e(31),tt=e.n(_),nt=function(t){function n(){return t.apply(this,arguments)||this}Object(U.a)(n,t);var e=n.prototype;return e.init=function(){t.prototype.init.call(this),app.session.user&&!0===app.session.user.data.attributes.canViewRankingPage||m.route("/"),this.loading=!0,this.users=[],this.refresh()},e.view=function(){var t,n=this;return t=this.loading?D.a.component():C.a.component({children:app.translator.trans("core.forum.discussion_list.load_more_button"),className:"Button",onclick:this.loadMore.bind(this)}),m("div",{className:"TagsPage"},N.a.prototype.hero(),m("div",{className:"container"},m("nav",{className:"RankingPage-nav IndexPage-nav sideNav",config:N.a.prototype.affixSidebar},m("ul",null,tt()(N.a.prototype.sidebarItems().toArray()))),m("div",{className:"RankingPage sideNavOffset"},m("table",{class:"rankings"},m("tr",null,m("th",{className:"rankings-mobile"},app.translator.trans("reflar-gamification.forum.ranking.rank")),m("th",null,app.translator.trans("reflar-gamification.forum.ranking.name")),m("th",null,app.translator.trans("reflar-gamification.forum.ranking.amount"))),this.users.map(function(t,e){return++e,[m("tr",{className:"ranking-"+e},e<4?"1"==app.forum.attribute("CustomRankingImages")?m("img",{className:"rankings-mobile rankings-image",src:app.forum.attribute("baseUrl")+app.forum.attribute("topimage"+e+"Url")}):m("td",{className:"rankings-mobile rankings-"+e},m("i",{className:"icon fas fa-trophy"})):m("td",{className:"rankings-4 rankings-mobile"},n.addOrdinalSuffix(e)),m("td",null,m("div",{className:"PostUser"},m("h3",{className:"rankings-info"},m("a",{href:app.route.user(t),config:m.route},e<4?J()(t,{className:"info-avatar rankings-"+e+"-avatar"}):""," ",Q()(t))))),e<4?m("td",{className:"rankings-"+e},t.data.attributes.Points):m("td",{className:"rankings-4"},t.data.attributes.Points))]})),m("div",{className:"rankings-loadmore"}," ",t))))},e.refresh=function(t){var n=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.users=[]),this.loadResults().then(function(t){n.users=[],n.parseResults(t)},function(){n.loading=!1,m.redraw()})},e.addOrdinalSuffix=function(t){if("en"==app.forum.attribute("DefaultLocale")){var n=t%10,e=t%100;return 1==n&&11!=e?t+"st":2==n&&12!=e?t+"nd":3==n&&13!=e?t+"rd":t+"th"}return t},e.stickyParams=function(){return{sort:m.route.param("sort"),q:m.route.param("q")}},e.actionItems=function(){var t=new O.a;return t.add("refresh",C.a.component({title:app.translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-refresh",className:"Button Button--icon",onclick:function(){app.cache.discussionList.refresh(),app.session.user&&(app.store.find("users",app.session.user.id()),m.redraw())}})),t},e.newDiscussion=function(){var t=m.deferred();return app.session.user?this.composeNewDiscussion(t):app.modal.show(new B.a({onlogin:this.composeNewDiscussion.bind(this,t)})),t.promise},e.composeNewDiscussion=function(t){var n=new DiscussionComposer({user:app.session.user});return app.composer.load(n),app.composer.show(),t.resolve(n),t.promise},e.loadResults=function(t){var n={};return n.page={offset:t,limit:"10"},app.store.find("rankings",n)},e.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},e.parseResults=function(t){return[].push.apply(this.users,t),this.loading=!1,this.users.sort(function(t,n){return parseFloat(n.data.attributes.Points)-parseFloat(t.data.attributes.Points)}),m.lazyRedraw(),t},n}(Z.a),et=e(32),rt=function(t){function n(){return t.apply(this,arguments)||this}Object(U.a)(n,t);var e=n.prototype;return e.icon=function(){return"Up"===this.props.notification.content()?"fas fa-thumbs-up":"fas fa-thumbs-down"},e.href=function(){return app.route.post(this.props.notification.subject())},e.content=function(){var t=this.props.notification.fromUser().username();return"Up"===this.props.notification.content()?app.translator.trans("reflar-gamification.forum.notification.upvote",{username:t}):app.translator.trans("reflar-gamification.forum.notification.downvote",{username:t})},e.excerpt=function(){return this.props.notification.subject().contentPlain()},n}(e.n(et).a);s.a.initializers.add("Reflar-Gamification",function(t){t.store.models.ranks=X.a,t.notificationComponents.vote=rt,t.routes.rankings={path:"/rankings",component:nt.component()},Object(r.extend)(T.a.prototype,"config",function(t,n,e){var o=this;n||s.a.pusher&&s.a.pusher.then(function(t){t.main.bind("newVote",function(t){var n=parseInt(t.userId);if(n!=s.a.session.user.id()){if(m.startComputation(),o.postId()==t.postId){var e=o.upvotedata(),r=o.downvotedata();switch(t.before){case"up":e=o.removeVote(e,n);break;case"down":r=o.removeVote(r,n)}switch(t.after){case"up":e.unshift({type:"users",id:n});break;case"down":r.unshift({type:"users",id:n});break;case"none":r=o.removeVote(r,n),e=o.removeVote(e,n)}o.downvotedata(r),o.upvotedata(e),m.redraw.strategy("all")}m.endComputation()}}),Object(r.extend)(e,"onunload",function(){return t.main.unbind("newVote")})})}),Object(r.extend)(F.a,"moderationControls",function(t,n){n.discussion().canSeeVotes()&&t.add("viewVotes",[m(C.a,{icon:"fas fa-thumbs-up",onclick:function(){s.a.modal.show(new W({post:n}))}},s.a.translator.trans("reflar-gamification.forum.mod_item"))])}),Object(r.extend)(T.a.prototype,"actionItems",function(t){var n=this.props.post;this.postId=m.prop(n.data.id),this.downvotedata=m.prop(n.data.relationships.downvotes.data),this.upvotedata=m.prop(n.data.relationships.upvotes.data);var e=s.a.session.user&&n.upvotes().some(function(t){return t===s.a.session.user}),r=s.a.session.user&&n.downvotes().some(function(t){return t===s.a.session.user});s.a.session.user||(r=!1,e=!1);var o=s.a.forum.attribute("IconName");null!==o&&""!==o||(o="thumbs"),this.removeVote=function(t,n){return t.some(function(e,r){e.id==n&&t.splice(r,1)}),t},t.add("upvote",C.a.component({icon:"fas fa-"+o+"-up",className:"Post-vote Post-upvote",style:!1!==e?"color:"+s.a.forum.data.attributes.themePrimaryColor:"color:",disabled:!n.discussion().canVote(),onclick:function(){if(s.a.session.user){if(n.discussion().canVote()){var t=n.data.relationships.upvotes.data,o=n.data.relationships.downvotes.data;e=!e,r=!1,n.save([e,r,"vote"]),t.some(function(n,e){if(n.id===s.a.session.user.id())return t.splice(e,1),!0}),o.some(function(t,n){if(t.id===s.a.session.user.id())return o.splice(n,1),!0}),e&&t.unshift({type:"users",id:s.a.session.user.id()})}}else s.a.modal.show(new B.a)}}),3),t.add("points",m("label",{className:"Post-points"},this.upvotedata().length-this.downvotedata().length),2),t.add("downvote",C.a.component({icon:"fas fa-"+o+"-down",className:"Post-vote Post-downvote",style:!1!==r?"color:"+s.a.forum.data.attributes.themePrimaryColor:"",disabled:!n.discussion().canVote(),onclick:function(){if(s.a.session.user){if(n.discussion().canVote()){var t=n.data.relationships.upvotes.data,o=n.data.relationships.downvotes.data;r=!r,e=!1,n.save([e,r,"vote"]),t.some(function(n,e){if(n.id===s.a.session.user.id())return t.splice(e,1),!0}),o.some(function(t,n){if(t.id===s.a.session.user.id())return o.splice(n,1),!0}),r&&o.unshift({type:"users",id:s.a.session.user.id()})}}else s.a.modal.show(new B.a)}}),1)}),L(),k()})},,function(t,n){t.exports=flarum.core.compat["components/PostUser"]},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["components/LinkButton"]},function(t,n){t.exports=flarum.core.compat["utils/PostControls"]},function(t,n){t.exports=flarum.core.compat["components/Modal"]},function(t,n){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["helpers/listItems"]},function(t,n){t.exports=flarum.core.compat["components/Notification"]},,,,,function(t,n,e){"use strict";e.r(n);var r=e(6);for(var o in r)"default"!==o&&function(t){e.d(n,t,function(){return r[t]})}(o);e(23)}]);
//# sourceMappingURL=forum.js.map