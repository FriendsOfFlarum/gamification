module.exports=function(t){var o={};function n(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=o,n.d=function(t,o,e){n.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,o){if(1&o&&(t=n(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var a in t)n.d(e,a,function(o){return t[o]}.bind(null,a));return e},n.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(o,"a",o),o},n.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},n.p="",n(n.s=46)}([,function(t,o){t.exports=flarum.core.compat["common/extend"]},function(t,o){t.exports=flarum.core.compat["common/Model"]},function(t,o){t.exports=flarum.core.compat["common/components/Button"]},function(t,o,n){"use strict";function e(t,o){return(e=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t})(t,o)}function a(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,e(t,o)}n.d(o,"a",(function(){return a}))},,function(t,o){t.exports=flarum.core.compat["forum/app"]},function(t,o,n){"use strict";n.d(o,"a",(function(){return i}));var e=n(4),a=n(2),r=n.n(a),s=n(18),i=function(t){function o(){return t.apply(this,arguments)||this}return Object(e.a)(o,t),o}(n.n(s)()(r.a,{points:r.a.attribute("points"),name:r.a.attribute("name"),color:r.a.attribute("color")}))},function(t,o,n){"use strict";function e(t,o){void 0===o&&(o={}),o.style=o.style||{},o.className="rankLabel "+(o.className||"");var n=t.color();return o.style.backgroundColor=o.style.color=n,o.className+=" colored",m("span",o,m("span",{className:"rankLabel-text"},t.name()))}n.d(o,"a",(function(){return e}))},,function(t,o){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,o){t.exports=flarum.core.compat["common/models/Post"]},function(t,o){t.exports=flarum.core.compat["common/utils/abbreviateNumber"]},function(t,o){t.exports=flarum.core.compat["forum/components/CommentPost"]},function(t,o){t.exports=flarum.core.compat["common/models/Discussion"]},,function(t,o,n){"use strict";n.d(o,"a",(function(){return e}));var e={Rank:n(7).a}},function(t,o,n){"use strict";n.d(o,"a",(function(){return e}));var e={rankLabel:n(8).a}},function(t,o){t.exports=flarum.core.compat["common/utils/mixin"]},function(t,o){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,o){t.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(t,o){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,o){t.exports=flarum.core.compat["common/helpers/username"]},function(t,o){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,o){t.exports=flarum.core.compat["common/components/Link"]},,function(t,o){t.exports=flarum.core.compat["common/models/User"]},function(t,o){t.exports=flarum.core.compat["forum/components/UserCard"]},function(t,o){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},function(t,o){t.exports=flarum.core.compat["common/components/Page"]},function(t,o){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,o){t.exports=flarum.core.compat["forum/states/DiscussionListState"]},function(t,o){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,o){t.exports=flarum.core.compat["common/utils/classList"]},function(t,o){t.exports=flarum.core.compat["forum/utils/PostControls"]},function(t,o){t.exports=flarum.core.compat["common/components/Modal"]},function(t,o){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,o){t.exports=flarum.core.compat["forum/components/PostUser"]},function(t,o,n){(function(o){var n=/^\s+|\s+$/g,e=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,r=/^0o[0-7]+$/i,s=parseInt,i="object"==typeof o&&o&&o.Object===Object&&o,c="object"==typeof self&&self&&self.Object===Object&&self,u=i||c||Function("return this")(),f=Object.prototype.toString,p=Math.max,m=Math.min,l=function(){return u.Date.now()};function d(t){var o=typeof t;return!!t&&("object"==o||"function"==o)}function v(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==f.call(t)}(t))return NaN;if(d(t)){var o="function"==typeof t.valueOf?t.valueOf():t;t=d(o)?o+"":o}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(n,"");var i=a.test(t);return i||r.test(t)?s(t.slice(2),i?2:8):e.test(t)?NaN:+t}t.exports=function(t,o,n){var e,a,r,s,i,c,u=0,f=!1,h=!1,b=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(o){var n=e,r=a;return e=a=void 0,u=o,s=t.apply(r,n)}function g(t){return u=t,i=setTimeout(N,o),f?y(t):s}function x(t){var n=t-c;return void 0===c||n>=o||n<0||h&&t-u>=r}function N(){var t=l();if(x(t))return k(t);i=setTimeout(N,function(t){var n=o-(t-c);return h?m(n,r-(t-u)):n}(t))}function k(t){return i=void 0,b&&e?y(t):(e=a=void 0,s)}function O(){var t=l(),n=x(t);if(e=arguments,a=this,c=t,n){if(void 0===i)return g(c);if(h)return i=setTimeout(N,o),y(c)}return void 0===i&&(i=setTimeout(N,o)),s}return o=v(o)||0,d(n)&&(f=!!n.leading,r=(h="maxWait"in n)?p(v(n.maxWait)||0,o):r,b="trailing"in n?!!n.trailing:b),O.cancel=function(){void 0!==i&&clearTimeout(i),u=0,e=c=a=i=void 0},O.flush=function(){return void 0===i?s:k(l())},O}}).call(this,n(45))},function(t,o){t.exports=flarum.core.compat["common/states/DiscussionListState"]},function(t,o){t.exports=flarum.core.compat["forum/components/Notification"]},function(t,o){t.exports=flarum.core.compat["forum/components/NotificationGrid"]},,,,function(t,o){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,o,n){"use strict";n.r(o),n.d(o,"models",(function(){return e.a})),n.d(o,"components",(function(){return It})),n.d(o,"helpers",(function(){return Ut}));var e=n(16),a=n(6),r=n.n(a),s=n(2),i=n.n(s),c=n(14),u=n.n(c),f=n(11),p=n.n(f),l=n(26),d=n.n(l),v=n(7),h=n(4),b=n(21),y=n.n(b),g=n(29),x=n.n(g),N=n(19),k=n.n(N),O=n(3),j=n.n(O),w=n(10),L=n.n(w),P=n(30),V=n.n(P),I=n(22),B=n.n(I),D=n(23),U=n.n(D),M=function(t,o){void 0===o&&(o=!1);var n=app.data["fof-gamification."+t];return o?!!parseInt(n):n},S=n(24),_=n.n(S),C=function(t){function o(){return t.apply(this,arguments)||this}Object(h.a)(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),app.session.user&&!0===app.session.user.data.attributes.canViewRankingPage||m.route.set("/"),this.loading=!0,this.users=[],this.refresh()},n.view=function(){var t,o=this;return t=this.loading?L.a.component():j.a.component({className:"Button",onclick:this.loadMore.bind(this)},app.translator.trans("core.forum.discussion_list.load_more_button")),m("div",{className:"IndexPage"},k.a.prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,V()(k.a.prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("table",{class:"rankings"},m("tr",null,m("th",{className:"rankings-mobile"},app.translator.trans("fof-gamification.forum.ranking.rank")),m("th",null,app.translator.trans("fof-gamification.forum.ranking.name")),m("th",null,app.translator.trans("fof-gamification.forum.ranking.amount"))),this.users.map((function(t,n){return++n,[m("tr",{className:"ranking-"+n},n<4?M("customRankingImages",!0)?m("img",{className:"rankings-mobile rankings-image",src:app.forum.attribute("baseUrl")+app.forum.attribute("fof-gamification.topimage"+n+"Url")}):m("td",{className:"rankings-mobile rankings-"+n},U()("fas fa-trophy")):m("td",{className:"rankings-4 rankings-mobile"},o.addOrdinalSuffix(n)),m("td",null,m("div",{className:"PostUser"},m("h3",{className:"rankings-info"},m(_.a,{href:app.route.user(t),force:!0},n<4?y()(t,{className:"info-avatar rankings-"+n+"-avatar"}):""," ",B()(t))))),n<4?m("td",{className:"rankings-"+n},t.points()):m("td",{className:"rankings-4"},t.points()))]}))),m("div",{className:"rankings-loadmore"}," ",t)))))},n.refresh=function(t){var o=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.users=[]),this.loadResults().then((function(t){o.users=[],o.parseResults(t)}),(function(){o.loading=!1,m.redraw()}))},n.addOrdinalSuffix=function(t){if("en"===app.data.locale){var o=t%10,n=t%100;return 1===o&&11!==n?t+"st":2===o&&12!==n?t+"nd":3===o&&13!==n?t+"rd":t+"th"}return t},n.loadResults=function(t){var o={};return o.page={offset:t,limit:"10"},app.store.find("rankings",o)},n.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},n.parseResults=function(t){return[].push.apply(this.users,t),this.loading=!1,this.users.sort((function(t,o){return parseFloat(o.points())-parseFloat(t.points())})),m.redraw(),t},o}(x.a),R=n(1),A=n(31),T=n.n(A),E=n(32),F=n.n(E),$=function(){Object(R.extend)(k.a.prototype,"navItems",(function(t){app.session.user&&!0===app.session.user.data.attributes.canViewRankingPage&&t.add("rankings",F.a.component({href:app.route("rankings"),icon:"fas fa-trophy"},app.translator.trans("fof-gamification.forum.nav.name")),80)})),Object(R.extend)(T.a.prototype,"sortMap",(function(t){t.hot="-hotness"}))},z=n(13),W=n.n(z),G=n(33),q=n.n(G),H=n(34),J=n.n(H),K=n(35),Q=function(t){function o(){return t.apply(this,arguments)||this}Object(h.a)(o,t);var n=o.prototype;return n.className=function(){return"VotesModal Modal--small"},n.title=function(){return app.translator.trans("fof-gamification.forum.modal.title")},n.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=!this.attrs.post.upvotes(),this.loading&&this.load()},n.content=function(){var t=this;return this.loading?m("div",{className:"Modal-body"},m(L.a,null)):m("div",{className:"Modal-body"},m("ul",{className:"VotesModal-list"},["upvotes"].map((function(o){var n=t.attrs.post[o]();if(n&&n.length)return m("div",null,m("legend",null,app.translator.trans("fof-gamification.forum.modal."+o+"_label")),n.map((function(t){return m("li",null,m(_.a,{href:app.route.user(t)},y()(t)," ",B()(t)))})))}))))},n.load=function(){return app.store.find("posts",this.attrs.post.id(),{include:"upvotes"}).then(this.loaded.bind(this))},o}(n.n(K).a),X=n(36),Y=n.n(X),Z=function(t,o,n,e,a){if(void 0===a&&(a=t.discussion()),app.session.user){if(!a||a.canVote()||t.canVote())return o&&n&&(o=!1,n=!1),e&&e(!0),m.redraw(),t.save([o,n,"vote"]).then((function(){return null}),(function(){return null})).then((function(){e&&e(!1),a&&a.pushAttributes({votes:t.votes()}),m.redraw()}))}else Y.a.replyAction.call(a,!0)},tt=function(){Object(R.extend)(J.a,"moderationControls",(function(t,o){o.seeVoters()&&t.add("viewVotes",[m(j.a,{icon:"fas fa-thumbs-up",onclick:function(){app.modal.show(Q,{post:o})}},app.translator.trans("fof-gamification.forum.mod_item"))])})),Object(R.extend)(W.a.prototype,"actionItems",(function(t){var o=this,n=this.attrs.post,e=n.hasDownvoted(),a=n.hasUpvoted(),r=M("iconName")||"thumbs",s=M("upVotesOnly",!0),i=n.canSeeVotes(),c=!app.session.user||n.canVote();t.add("votes",m("div",{className:q()("CommentPost-votes",M("useAlternateLayout",!0)&&"alternateLayout")},j.a.component({icon:this.voteLoading?void 0:"fas fa-fw fa-"+r+"-up",className:"Post-vote Post-upvote",style:a&&{color:app.forum.attribute("themePrimaryColor")},loading:this.voteLoading,disabled:this.voteLoading||!c||!i,onclick:function(){return Z(n,!a,!1,(function(t){return o.voteLoading=t}))}}),m("label",{className:"Post-points"},n.votes()),s?"":j.a.component({icon:this.voteLoading?void 0:"fas fa-fw fa-"+r+"-down",className:"Post-vote Post-downvote",style:e&&{color:app.forum.attribute("themePrimaryColor")},loading:this.voteLoading,disabled:!c||!i,onclick:function(){return Z(n,!1,!e,(function(t){return o.voteLoading=t}))}})),10)}))},ot=n(20),nt=n.n(ot),et=n(12),at=n.n(et),rt=function(){M("showVotesOnDiscussionPage",!0)&&!M("useAlternateLayout",!0)&&Object(R.extend)(nt.a.prototype,"infoItems",(function(t){this.attrs.discussion.seeVotes()&&t.add("discussion-votes",m("span",{className:"DiscussionListItem-votes",title:app.translator.trans("fof-gamification.forum.votes")},U()("far fa-thumbs-up"),at()(this.attrs.discussion.votes())),20)}))},st=n(37),it=n.n(st),ct=n(27),ut=n.n(ct),ft=n(8),pt=function(){var t=function(t){return function(o){return o&&o.attrs&&o.attrs.className&&String(o.attrs.className).split(" ").includes(t)}};Object(R.extend)(ut.a.prototype,"infoItems",(function(t){var o,n=M("pointsPlaceholder"),e=String(this.attrs.user.points());o=n?m("div",null,n.replace("{points}",e)):app.translator.trans("fof-gamification.forum.user.points",{points:e}),t.add("points",o)})),Object(R.extend)(ut.a.prototype,"view",(function(o){var n=this.attrs.user,e=function o(n,e){var a=[];if(n&&n.children&&Array.isArray(n.children)){var r=n.children.find(t(e));r&&a.push(r),n.children.forEach((function(t){a.push.apply(a,o(t,e))}))}return a}(o,"UserCard-profile")[0],a=Number(M("rankAmt"));if(e){var r=e.children.find(t("UserCard-badges"));return n.ranks()&&(r?n.ranks().reverse().map((function(t,o){if(!a||o<a)return m("li",{className:"User-Rank"},Object(ft.a)(t))})).forEach((function(t){t&&r.children.push(t)})):e.children.splice(1,0,m("ul",{className:"UserCard-badges badges"},n.ranks().reverse().map((function(t,o){if(!a||o<a)return m("li",{className:"User-Rank"},Object(ft.a)(t))}))))),o}})),Object(R.extend)(it.a.prototype,"view",(function(t){var o,n=this.attrs.post.user();if(!n)return t;var e,a=t.children.find((e="h3",function(t){return t&&t.tag&&t.tag===e})),r=null!=(o=Number(M("rankAmt")))?o:n.ranks().length;a.children=a.children.concat(n.ranks().reverse().splice(0,r).map((function(t){return m("span",{className:"Post-Rank"},Object(ft.a)(t))}))).filter((function(t){return void 0!==t.tag}))}))},mt=n(28),lt=n.n(mt),dt=n(38),vt=n.n(dt),ht=function(t){return app.store.find("posts",t).then((function(){return m.redraw()}))},bt=[],yt=function(){Object(R.extend)(lt.a.prototype,"oncreate",(function(){app.pusher&&app.pusher.then((function(t){t.main.bind("newVote",(function(t){var o,n,e=app.store.getById("posts",t.post_id),a=t.user_id;e&&e.votes()!==t.votes&&a!=app.session.user.id()&&(o=e.id(),(n=bt[o])?n(o):(n=bt[o]=vt()(ht,1500))(o))}))}))})),Object(R.extend)(lt.a.prototype,"onremove",(function(){app.pusher&&app.pusher.then((function(t){t.main.unbind("newVote")}))}))},gt=function(t,o){var n=t.firstPost();return n&&void 0!==n[o]()?n[o]():t[o]()};function xt(t){return t?{color:"var(--primary-color) !important"}:{}}function Nt(){Object(R.extend)(nt.a.prototype,"oninit",(function(){var t=this;this.attrs.discussion.seeVotes()&&this.subtree.check((function(){return t.voteLoading}))})),Object(R.extend)(nt.a.prototype,"view",(function(t){var o=this,n=this.attrs.discussion;if(n.seeVotes()&&t&&t.children){var e=t.children.find((function(t){return t&&t.attrs&&t.attrs.className&&t.attrs.className.includes("DiscussionListItem-content")})),a=n.firstPost(),r=gt(n,"hasUpvoted"),s=gt(n,"hasDownvoted"),i=!app.session.user||gt(n,"canVote"),c=M("upVotesOnly",!0),u=M("iconNameAlt")||"arrow";e.children.unshift(m("div",{className:"DiscussionListItem-votes alternateLayout","data-upvotes-only":c},m(j.a,{className:"DiscussionListItem-voteButton DiscussionListItem-voteButton--up Button Button--icon Button--text",icon:"fas fa-fw fa-"+u+"-up",style:xt(r),"data-active":r,disabled:!i||this.voteLoading,onclick:function(){Z(a,!r,!1,(function(t){o.voteLoading=t}))}}),m("span",{class:"DiscussionListItem-voteCount"},at()(gt(n,"votes")||0)),!c&&m(j.a,{className:"DiscussionListItem-voteButton DiscussionListItem-voteButton--down Button Button--icon Button--text",icon:"fas fa-fw fa-"+u+"-down",style:xt(s),"data-active":s,disabled:!i||this.voteLoading,onclick:function(){Z(a,!1,!s,(function(t){o.voteLoading=t}))}}),this.voteLoading&&m(L.a,{display:"inline",size:"small"})))}}))}var kt=n(39),Ot=n.n(kt);function jt(t){return t?{color:"var(--primary-color) !important"}:{}}var wt=n(40),Lt=function(t){function o(){return t.apply(this,arguments)||this}Object(h.a)(o,t);var n=o.prototype;return n.icon=function(){return this.attrs.notification.content()>0?"fas fa-thumbs-up":"fas fa-thumbs-down"},n.href=function(){return r.a.route.post(this.attrs.notification.subject())},n.content=function(){var t=this.attrs.notification.fromUser(),o=parseInt(this.attrs.notification.content());return o>0?r.a.translator.trans("fof-gamification.forum.notification.upvote",{user:t}):r.a.translator.trans("fof-gamification.forum.notification.downvote",{user:t})},n.excerpt=function(){return this.attrs.notification.subject().contentPlain()},o}(n.n(wt).a),Pt=n(41),Vt=n.n(Pt);var It={RankingsPage:C,VoteNotification:Lt,VotesModal:Q};function Bt(){return(Bt=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}var Dt=n(17),Ut=Bt({saveVote:Z,setting:M},Dt.a);r.a.initializers.add("fof-gamification",(function(t){u.a.prototype.votes=i.a.attribute("votes"),u.a.prototype.hasUpvoted=i.a.attribute("hasUpvoted"),u.a.prototype.hasDownvoted=i.a.attribute("hasDownvoted"),u.a.prototype.canVote=i.a.attribute("canVote"),u.a.prototype.seeVotes=i.a.attribute("seeVotes"),d.a.prototype.points=i.a.attribute("points"),d.a.prototype.ranks=i.a.hasMany("ranks"),p.a.prototype.upvotes=i.a.hasMany("upvotes"),p.a.prototype.votes=i.a.attribute("votes"),p.a.prototype.canVote=i.a.attribute("canVote"),p.a.prototype.canSeeVotes=i.a.attribute("canSeeVotes"),p.a.prototype.hasUpvoted=i.a.attribute("hasUpvoted"),p.a.prototype.hasDownvoted=i.a.attribute("hasDownvoted"),p.a.prototype.seeVoters=i.a.attribute("seeVoters"),t.store.models.ranks=v.a,t.routes.rankings={path:"/rankings",component:C},tt(),$(),Object(R.extend)(Ot.a.prototype,"sortMap",(function(t){t.votes="-votes"})),pt(),rt(),yt(),r.a.notificationComponents.vote=Lt,Object(R.extend)(Vt.a.prototype,"notificationTypes",(function(t){t.add("vote",{name:"vote",icon:"fas fa-thumbs-up",label:r.a.translator.trans("fof-gamification.forum.notification.prefrences.vote")})})),M("useAlternateLayout",!0)&&Nt(),M("altPostVotingUi",!0)&&(Object(R.extend)(W.a.prototype,"actionItems",(function(t){t.remove("votes")})),Object(R.extend)(W.a.prototype,"classes",(function(t){var o=M("upVotesOnly",!0);t.push("votesAlternativeLayout"),o&&t.push("votesUpvotesOnly")})),Object(R.extend)(W.a.prototype,"headerItems",(function(t){var o=this,n=this.attrs.post;if(n.canSeeVotes()){var e=n.hasDownvoted(),a=n.hasUpvoted(),s=M("iconName")||"thumbs",i=M("upVotesOnly",!0),c=n.canSeeVotes(),u=!r.a.session.user||n.canVote();t.add("votes",m("div",{className:"Post-votes alternateLayout","data-upvotes-only":i},m(j.a,{className:"Post-voteButton Post-voteButton--up Button Button--icon Button--text",icon:"fas fa-fw fa-"+s+"-up",style:jt(a),"data-active":a,disabled:!u||this.voteLoading||!c,onclick:function(){Z(n,!a,!1,(function(t){o.voteLoading=t}))}}),m("span",{class:"Post-voteCount"},at()(n.votes()||0)),!i&&m(j.a,{className:"Post-voteButton Post-voteButton--down Button Button--icon Button--text",icon:"fas fa-fw fa-"+s+"-down",style:jt(e),"data-active":e,disabled:!u||this.voteLoading,onclick:function(){Z(n,!1,!e,(function(t){o.voteLoading=t}))}}),this.voteLoading&&m(L.a,{display:"inline",size:"small"})),1e4)}})))}))}]);
//# sourceMappingURL=forum.js.map