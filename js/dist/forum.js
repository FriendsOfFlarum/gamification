module.exports=function(t){var o={};function n(e){if(o[e])return o[e].exports;var r=o[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=o,n.d=function(t,o,e){n.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,o){if(1&o&&(t=n(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var r in t)n.d(e,r,function(o){return t[o]}.bind(null,r));return e},n.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(o,"a",o),o},n.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},n.p="",n(n.s=42)}([function(t,o){t.exports=flarum.core.compat.extend},function(t,o){t.exports=flarum.core.compat.Model},function(t,o){t.exports=flarum.core.compat["components/Button"]},function(t,o,n){"use strict";function e(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o}n.d(o,"a",(function(){return e}))},function(t,o){t.exports=flarum.core.compat["components/IndexPage"]},function(t,o){t.exports=flarum.core.compat["models/Post"]},function(t,o){t.exports=flarum.core.compat["helpers/icon"]},,function(t,o){},function(t,o,n){"use strict";n.d(o,"a",(function(){return i}));var e=n(3),r=n(1),a=n.n(r),s=n(10),i=function(t){function o(){return t.apply(this,arguments)||this}return Object(e.a)(o,t),o}(n.n(s)()(a.a,{points:a.a.attribute("points"),name:a.a.attribute("name"),color:a.a.attribute("color")}))},function(t,o){t.exports=flarum.core.compat["utils/mixin"]},function(t,o){t.exports=flarum.core.compat["components/Page"]},function(t,o){t.exports=flarum.core.compat["components/DiscussionListItem"]},function(t,o){t.exports=flarum.core.compat["models/Discussion"]},function(t,o){t.exports=flarum.core.compat["helpers/avatar"]},function(t,o){t.exports=flarum.core.compat["utils/ItemList"]},function(t,o){t.exports=flarum.core.compat["components/LogInModal"]},function(t,o){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,o){t.exports=flarum.core.compat["helpers/username"]},function(t,o){t.exports=flarum.core.compat["utils/abbreviateNumber"]},,function(t,o){t.exports=flarum.core.compat["models/User"]},function(t,o){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,o){t.exports=flarum.core.compat["components/UserCard"]},,function(t,o,n){"use strict";var e=n(1),r=n.n(e),a=n(13),s=n.n(a),i=n(5),u=n.n(i),c=n(21),p=n.n(c),f=n(9),l=n(3),d=n(14),h=n.n(d),v=n(11),b=n.n(v),g=n(4),y=n.n(g),x=n(2),w=n.n(x),k=n(15),N=n.n(k),j=n(16),O=n.n(j),P=n(17),L=n.n(P),D=n(27),M=n.n(D),_=n(18),I=n.n(_),U=n(6),V=n.n(U),S=function(t,o){void 0===o&&(o=!1);var n=app.data["fof-gamification."+t];return o?!!Number(n):n},C=function(t){function o(){return t.apply(this,arguments)||this}Object(l.a)(o,t);var n=o.prototype;return n.init=function(){t.prototype.init.call(this),app.session.user&&!0===app.session.user.data.attributes.canViewRankingPage||m.route("/"),this.loading=!0,this.users=[],this.refresh()},n.view=function(){var t,o=this;return t=this.loading?L.a.component():w.a.component({children:app.translator.trans("core.forum.discussion_list.load_more_button"),className:"Button",onclick:this.loadMore.bind(this)}),m("div",{className:"TagsPage"},y.a.prototype.hero(),m("div",{className:"container"},m("nav",{className:"RankingPage-nav IndexPage-nav sideNav",config:y.a.prototype.affixSidebar},m("ul",null,M()(y.a.prototype.sidebarItems().toArray()))),m("div",{className:"RankingPage sideNavOffset"},m("table",{class:"rankings"},m("tr",null,m("th",{className:"rankings-mobile"},app.translator.trans("fof-gamification.forum.ranking.rank")),m("th",null,app.translator.trans("fof-gamification.forum.ranking.name")),m("th",null,app.translator.trans("fof-gamification.forum.ranking.amount"))),this.users.map((function(t,n){return++n,[m("tr",{className:"ranking-"+n},n<4?S("customRankingImages",!0)?m("img",{className:"rankings-mobile rankings-image",src:app.forum.attribute("baseUrl")+app.forum.attribute("fof-gamification.topimage"+n+"Url")}):m("td",{className:"rankings-mobile rankings-"+n},V()("fas fa-trophy")):m("td",{className:"rankings-4 rankings-mobile"},o.addOrdinalSuffix(n)),m("td",null,m("div",{className:"PostUser"},m("h3",{className:"rankings-info"},m("a",{href:app.route.user(t),config:m.route},n<4?h()(t,{className:"info-avatar rankings-"+n+"-avatar"}):""," ",I()(t))))),n<4?m("td",{className:"rankings-"+n},t.points()):m("td",{className:"rankings-4"},t.points()))]}))),m("div",{className:"rankings-loadmore"}," ",t))))},n.refresh=function(t){var o=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.users=[]),this.loadResults().then((function(t){o.users=[],o.parseResults(t)}),(function(){o.loading=!1,m.redraw()}))},n.addOrdinalSuffix=function(t){if("en"===app.data.locale){var o=t%10,n=t%100;return 1===o&&11!==n?t+"st":2===o&&12!==n?t+"nd":3===o&&13!==n?t+"rd":t+"th"}return t},n.stickyParams=function(){return{sort:m.route.param("sort"),q:m.route.param("q")}},n.actionItems=function(){var t=new N.a;return t.add("refresh",w.a.component({title:app.translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-refresh",className:"Button Button--icon",onclick:function(){app.cache.discussionList.refresh(),app.session.user&&(app.store.find("users",app.session.user.id()),m.redraw())}})),t},n.newDiscussion=function(){var t=m.deferred();return app.session.user?this.composeNewDiscussion(t):app.modal.show(new O.a({onlogin:this.composeNewDiscussion.bind(this,t)})),t.promise},n.composeNewDiscussion=function(t){var o=new DiscussionComposer({user:app.session.user});return app.composer.load(o),app.composer.show(),t.resolve(o),t.promise},n.loadResults=function(t){var o={};return o.page={offset:t,limit:"10"},app.store.find("rankings",o)},n.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},n.parseResults=function(t){return[].push.apply(this.users,t),this.loading=!1,this.users.sort((function(t,o){return parseFloat(o.points())-parseFloat(t.points())})),m.lazyRedraw(),t},o}(b.a),R=n(28),T=function(t){function o(){return t.apply(this,arguments)||this}Object(l.a)(o,t);var n=o.prototype;return n.icon=function(){return this.props.notification.content()>0?"fas fa-thumbs-up":"fas fa-thumbs-down"},n.href=function(){return app.route.post(this.props.notification.subject())},n.content=function(){var t=this.props.notification.fromUser(),o=this.props.notification.content();return o>0?app.translator.trans("fof-gamification.forum.notification.upvote",{user:t}):app.translator.trans("fof-gamification.forum.notification.downvote",{user:t})},n.excerpt=function(){return this.props.notification.subject().contentPlain()},o}(n.n(R).a),A=n(0),B=n(22),q=n.n(B),F=n(29),E=n.n(F),z=n(30),W=n.n(z),G=function(){y.a.prototype.viewItems=function(){var t=this,o=new N.a,n=app.cache.discussionList.sortMap(),e={};for(var r in n)e[r]=app.translator.trans("core.forum.index_sort."+r+"_button");var a=e[this.params().sort]||Object.keys(n).map((function(t){return e[t]}))[0];return/^.*?\/hot/.test(m.route())&&(a=app.translator.trans("core.forum.index_sort.hot_button")),o.add("sort",E.a.component({buttonClassName:"Button",label:a,children:Object.keys(e).map((function(o){var r=e[o],a=(t.params().sort||Object.keys(n)[0])===o;return/^.*?\/hot/.test(m.route())&&"hot"===o&&(a=!0),/^.*?\/hot/.test(m.route())&&"latest"===o&&(a=!1,m.redraw()),w.a.component({children:r,icon:!a||"fas fa-check",onclick:t.changeSort.bind(t,o),active:a})}))})),o},Object(A.extend)(y.a.prototype,"navItems",(function(t){t.add("rankings",W.a.component({href:app.route("rankings"),children:app.translator.trans("fof-gamification.forum.nav.name"),icon:"fas fa-trophy"}),80)})),y.a.prototype.changeSort=function(t){var o=this.params();"hot"===t?(m.route("/"),m.route(m.route()+"hot")):(t===Object.keys(app.cache.discussionList.sortMap())[0]?delete o.sort:o.sort=t,"hot"===o.filter&&delete o.filter,m.route(app.route("index",o)))},Object(A.extend)(q.a.prototype,"sortMap",(function(t){t.hot="hot"})),Object(A.extend)(q.a.prototype,"requestParams",(function(t){"hot"===this.props.params.filter&&(t.filter.q=" is:hot")}))},H=n(31),J=n.n(H),K=n(32),Q=n.n(K),X=n(33),Y=function(t){function o(){return t.apply(this,arguments)||this}Object(l.a)(o,t);var n=o.prototype;return n.className=function(){return"VotesModal Modal--small"},n.title=function(){return app.translator.trans("fof-gamification.forum.modal.title")},n.init=function(){this.loading=!this.props.post.upvotes()||!this.props.post.downvotes(),this.loading&&this.load()},n.content=function(){var t=this;return this.loading?m("div",{className:"Modal-body"},m(L.a,null)):m("div",{className:"Modal-body"},m("ul",{className:"VotesModal-list"},["upvotes","downvotes"].map((function(o){var n=t.props.post[o]();if(n&&n.length)return m("div",null,m("legend",null,app.translator.trans("fof-gamification.forum.modal."+o+"_label")),n.map((function(t){return m("li",null,m("a",{href:app.route.user(t),config:m.route},h()(t)," ",I()(t)))})))}))))},n.load=function(){return app.store.find("posts",this.props.post.id(),{include:"upvotes,downvotes"}).then(this.loaded.bind(this))},o}(n.n(X).a),Z=function(t,o,n,e,r){if(void 0===r&&(r=t.discussion()),app.session.user){if(!r||r.canVote()||t.canVote())return o&&n&&(o=!1,n=!1),console.log(e),e&&e(!0),m.redraw(),t.save([o,n,"vote"]).then((function(){return null}),(function(){return null})).then((function(){e&&e(!1),r&&r.pushAttributes({votes:t.votes()}),m.redraw()}))}else app.modal.show(new O.a)},tt=function(){Object(A.extend)(Q.a,"moderationControls",(function(t,o){o.canSeeVotes()&&t.add("viewVotes",[m(w.a,{icon:"fas fa-thumbs-up",onclick:function(){app.modal.show(new Y({post:o}))}},app.translator.trans("fof-gamification.forum.mod_item"))])})),Object(A.extend)(J.a.prototype,"actionItems",(function(t){var o=this,n=this.props.post,e=n.hasDownvoted(),r=n.hasUpvoted(),a=S("iconName")||"thumbs",s=n.canVote();t.add("votes",m("div",{className:"CommentPost-votes "+(S("useAlternateLayout",!0)&&"alternateLayout")},w.a.component({icon:this.voteLoading||"fas fa-"+a+"-up",className:"Post-vote Post-upvote",style:r&&{color:app.forum.attribute("themePrimaryColor")},loading:this.voteLoading,disabled:this.voteLoading||!s,onclick:function(){return Z(n,!r,!1,(function(t){return o.voteLoading=t}))}}),m("label",{className:"Post-points"},n.votes()),w.a.component({icon:this.voteLoading||"fas fa-"+a+"-down",className:"Post-vote Post-downvote",style:e&&{color:app.forum.attribute("themePrimaryColor")},loading:this.voteLoading,disabled:!s,onclick:function(){return Z(n,!1,!e,(function(t){return o.voteLoading=t}))}})),10)}))},ot=n(12),nt=n.n(ot),et=n(19),rt=n.n(et),at=function(){Object(A.extend)(nt.a.prototype,"infoItems",(function(t){if(S("showVotesOnDiscussionPage",!0)){if(S("useAlternateLayout",!0))return;$(".DiscussionListItem-info").find(".item-tags").addClass("gamification"),t.add("discussion-votes",m("span",{className:"DiscussionListItem-votes",title:app.translator.trans("fof-gamification.forum.votes")},V()("far fa-thumbs-up"),rt()(this.props.discussion.votes())),10)}}))},st=n(34),it=n.n(st),ut=n(23),ct=n.n(ut);function pt(t,o){void 0===o&&(o={}),o.style=o.style||{},o.className="rankLabel "+(o.className||"");var n=t.color();return o.style.backgroundColor=o.style.color=n,o.className+=" colored",m("span",o,m("span",{className:"rankLabel-text"},t.name()))}var ft=function(){var t=function(t){return function(o){return o&&o.attrs&&o.attrs.className&&String(o.attrs.className).split(" ").includes(t)}};Object(A.extend)(ct.a.prototype,"infoItems",(function(t){var o,n=S("pointsPlaceholder"),e=String(this.props.user.points());o=n?n.replace("{points}",e):app.translator.trans("fof-gamification.forum.user.points",{points:e}),t.add("points",o)})),Object(A.extend)(ct.a.prototype,"view",(function(o){var n=this.props.user,e=function o(n,e){var r=[];if(n&&n.children){var a=n.children.find(t(e));a&&r.push(a),n.children.forEach((function(t){r.push.apply(r,o(t,e))}))}return r}(o,"UserCard-profile")[0],r=Number(S("rankAmt"));if(e){var a=e.children.find(t("UserCard-badges"));return n.ranks()&&(a?a.children.push(n.ranks().reverse().map((function(t,o){if(!r||o<r)return m("li",{className:"User-Rank"},pt(t))}))):e.children.splice(1,0,m("ul",{className:"UserCard-badges badges"},n.ranks().reverse().map((function(t,o){if(!r||o<r)return m("li",{className:"User-Rank"},pt(t))}))))),o}})),Object(A.extend)(it.a.prototype,"view",(function(t){var o=this.props.post.user();if(!o)return t;var n,e=t.children.find((n="h3",function(t){return t&&t.tag&&t.tag===n})),r=Number(S("rankAmt"));e.children.push(o.ranks().reverse().map((function(t,o){if(!r||o<r)return m("span",{className:"Post-Rank"},pt(t))})))}))},lt=n(35),mt=n.n(lt),dt=n(36),ht=n.n(dt),vt=function(t){return app.store.find("posts",t).then((function(){return m.redraw()}))},bt=[],gt=function(){Object(A.extend)(mt.a.prototype,"config",(function(t,o,n){o||app.pusher&&app.pusher.then((function(t){t.main.bind("newVote",(function(t){var o,n,e=app.store.getById("posts",t.post_id),r=t.user_id;e&&e.votes()!==t.votes&&r!=app.session.user.id()&&(o=e.id(),(n=bt[o])?n(o):(n=bt[o]=ht()(vt,1500))(o))})),Object(A.extend)(n,"onunload",(function(){return t.main.unbind("newVote")}))}))}))};function yt(){return(yt=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}var xt=function(t,o){var n=t.firstPost();return n&&void 0!==n[o]()?(console.log(o,"post",n[o]()),n[o]()):t[o]()},wt=function(){Object(A.extend)(nt.a.prototype,"init",(function(){this.voteLoading=m.prop(!1)})),Object(A.extend)(nt.a.prototype,"view",(function(t){if(t&&t.children){var o=t.children.find((function(t){return t&&t.attrs&&t.attrs.className&&t.attrs.className.includes("DiscussionListItem-content")})),n=this.props.discussion,e=n.firstPost(),r=xt(n,"hasUpvoted"),a=xt(n,"hasDownvoted"),s=xt(n,"canVote"),i={color:app.forum.attribute("themePrimaryColor")},u={disabled:!s},c=S("useAlternateLayout",!0);o.children.unshift(m("div",{className:"DiscussionListItem-votes "+(c&&"alternateLayout")},V()("fas fa-arrow-up",yt({style:r?i:{},onclick:s&&function(){return Z(e,!r,!1,null,n)}},u)),m("span",null,rt()(xt(n,"votes")||0)),V()("fas fa-arrow-down",yt({style:a?i:{},onclick:s&&function(){return Z(e,!1,!a,null,n)}},u))))}}))};app.initializers.add("fof-gamification",(function(t){s.a.prototype.votes=r.a.attribute("votes"),s.a.prototype.hasUpvoted=r.a.attribute("hasUpvoted"),s.a.prototype.hasDownvoted=r.a.attribute("hasDownvoted"),s.a.prototype.canVote=r.a.attribute("canVote"),p.a.prototype.points=r.a.attribute("points"),p.a.prototype.ranks=r.a.hasMany("ranks"),u.a.prototype.upvotes=r.a.hasMany("upvotes"),u.a.prototype.downvotes=r.a.hasMany("downvotes"),u.a.prototype.votes=r.a.attribute("votes"),u.a.prototype.canVote=r.a.attribute("canVote"),u.a.prototype.canSeeVotes=r.a.attribute("canSeeVotes"),u.a.prototype.hasUpvoted=r.a.attribute("hasUpvoted"),u.a.prototype.hasDownvoted=r.a.attribute("hasDownvoted"),t.store.models.ranks=f.a,t.notificationComponents.vote=T,t.routes.rankings={path:"/rankings",component:C.component()},tt(),G(),ft(),at(),gt(),S("useAlternateLayout",!0)&&wt()}))},,function(t,o){t.exports=flarum.core.compat["helpers/listItems"]},function(t,o){t.exports=flarum.core.compat["components/Notification"]},function(t,o){t.exports=flarum.core.compat["components/Dropdown"]},function(t,o){t.exports=flarum.core.compat["components/LinkButton"]},function(t,o){t.exports=flarum.core.compat["components/CommentPost"]},function(t,o){t.exports=flarum.core.compat["utils/PostControls"]},function(t,o){t.exports=flarum.core.compat["components/Modal"]},function(t,o){t.exports=flarum.core.compat["components/PostUser"]},function(t,o){t.exports=flarum.core.compat["components/DiscussionPage"]},function(t,o,n){(function(o){var n=/^\s+|\s+$/g,e=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,a=/^0o[0-7]+$/i,s=parseInt,i="object"==typeof o&&o&&o.Object===Object&&o,u="object"==typeof self&&self&&self.Object===Object&&self,c=i||u||Function("return this")(),p=Object.prototype.toString,f=Math.max,l=Math.min,m=function(){return c.Date.now()};function d(t){var o=typeof t;return!!t&&("object"==o||"function"==o)}function h(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==p.call(t)}(t))return NaN;if(d(t)){var o="function"==typeof t.valueOf?t.valueOf():t;t=d(o)?o+"":o}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(n,"");var i=r.test(t);return i||a.test(t)?s(t.slice(2),i?2:8):e.test(t)?NaN:+t}t.exports=function(t,o,n){var e,r,a,s,i,u,c=0,p=!1,v=!1,b=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function g(o){var n=e,a=r;return e=r=void 0,c=o,s=t.apply(a,n)}function y(t){return c=t,i=setTimeout(w,o),p?g(t):s}function x(t){var n=t-u;return void 0===u||n>=o||n<0||v&&t-c>=a}function w(){var t=m();if(x(t))return k(t);i=setTimeout(w,function(t){var n=o-(t-u);return v?l(n,a-(t-c)):n}(t))}function k(t){return i=void 0,b&&e?g(t):(e=r=void 0,s)}function N(){var t=m(),n=x(t);if(e=arguments,r=this,u=t,n){if(void 0===i)return y(u);if(v)return i=setTimeout(w,o),g(u)}return void 0===i&&(i=setTimeout(w,o)),s}return o=h(o)||0,d(n)&&(p=!!n.leading,a=(v="maxWait"in n)?f(h(n.maxWait)||0,o):a,b="trailing"in n?!!n.trailing:b),N.cancel=function(){void 0!==i&&clearTimeout(i),c=0,e=u=r=i=void 0},N.flush=function(){return void 0===i?s:k(m())},N}}).call(this,n(43))},,,,,,function(t,o,n){"use strict";n.r(o);var e=n(8);for(var r in e)"default"!==r&&function(t){n.d(o,t,(function(){return e[t]}))}(r);n(25)},function(t,o){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}]);
//# sourceMappingURL=forum.js.map