module.exports=function(t){var o={};function n(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=o,n.d=function(t,o,e){n.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,o){if(1&o&&(t=n(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var a in t)n.d(e,a,function(o){return t[o]}.bind(null,a));return e},n.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(o,"a",o),o},n.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},n.p="",n(n.s=40)}([function(t,o){t.exports=flarum.core.compat.extend},function(t,o){t.exports=flarum.core.compat.Model},function(t,o){t.exports=flarum.core.compat["components/Button"]},function(t,o){t.exports=flarum.core.compat.app},function(t,o,n){"use strict";function e(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o}n.d(o,"a",(function(){return e}))},function(t,o){t.exports=flarum.core.compat["components/IndexPage"]},function(t,o){t.exports=flarum.core.compat["models/Post"]},function(t,o){},function(t,o,n){"use strict";n.d(o,"a",(function(){return i}));var e=n(4),a=n(1),r=n.n(a),s=n(9),i=function(t){function o(){return t.apply(this,arguments)||this}return Object(e.a)(o,t),o}(n.n(s)()(r.a,{points:r.a.attribute("points"),name:r.a.attribute("name"),color:r.a.attribute("color")}))},function(t,o){t.exports=flarum.core.compat["utils/mixin"]},function(t,o){t.exports=flarum.core.compat["components/Page"]},function(t,o){t.exports=flarum.core.compat["helpers/avatar"]},function(t,o){t.exports=flarum.core.compat["helpers/username"]},,function(t,o){t.exports=flarum.core.compat["utils/ItemList"]},function(t,o){t.exports=flarum.core.compat["components/LogInModal"]},function(t,o){t.exports=flarum.core.compat["helpers/icon"]},function(t,o){t.exports=flarum.core.compat["models/Discussion"]},,function(t,o){t.exports=flarum.core.compat["models/User"]},function(t,o){t.exports=flarum.core.compat["components/UserCard"]},function(t,o){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,o){t.exports=flarum.core.compat["components/CommentPost"]},,function(t,o,n){"use strict";var e=n(0),a=n(3),r=n.n(a),s=n(17),i=n.n(s),u=n(1),c=n.n(u),p=n(6),f=n.n(p),l=n(26),d=n.n(l),h=n(19),v=n.n(h),b=n(20),g=n.n(b);function y(t,o){void 0===o&&(o={}),o.style=o.style||{},o.className="rankLabel "+(o.className||"");var n=t.color();return o.style.backgroundColor=o.style.color=n,o.className+=" colored",m("span",o,m("span",{className:"rankLabel-text"},t.name()))}var k=function(t,o){void 0===o&&(o=!1);var n=app.data["fof-gamification."+t];return o?!!Number(n):n},x=function(){i.a.prototype.canVote=c.a.attribute("canVote"),i.a.prototype.canSeeVotes=c.a.attribute("canSeeVotes"),i.a.prototype.votes=c.a.attribute("votes"),v.a.prototype.points=c.a.attribute("points"),v.a.prototype.ranks=c.a.hasMany("ranks"),f.a.prototype.upvotes=c.a.hasMany("upvotes"),f.a.prototype.downvotes=c.a.hasMany("downvotes"),f.a.prototype.votes=c.a.attribute("votes"),f.a.prototype.hasUpvoted=c.a.attribute("hasUpvoted"),f.a.prototype.hasDownvoted=c.a.attribute("hasDownvoted");var t=function(t){return function(o){return o&&o.attrs&&o.attrs.className&&String(o.attrs.className).split(" ").includes(t)}};Object(e.extend)(g.a.prototype,"infoItems",(function(t){var o,n=k("pointsPlaceholder");o=n?n.replace("{points}",this.props.user.points()):app.translator.trans("fof-gamification.forum.user.points",{points:this.props.user.points()}),t.add("points",o)})),Object(e.extend)(g.a.prototype,"view",(function(o){var n=this.props.user,e=function o(n,e){var a=[];if(n&&n.children){var r=n.children.find(t(e));r&&a.push(r),n.children.forEach((function(t){a.push.apply(a,o(t,e))}))}return a}(o,"UserCard-profile")[0],a=Number(k("rankAmt"));if(e){var r=e.children.find(t("UserCard-badges"));return n.ranks()&&(r?r.children.push(n.ranks().reverse().map((function(t,o){if(!a||o<a)return m("li",{className:"User-Rank"},y(t))}))):e.children.splice(1,0,m("ul",{className:"UserCard-badges badges"},n.ranks().reverse().map((function(t,o){if(!a||o<a)return m("li",{className:"User-Rank"},y(t))}))))),o}})),Object(e.extend)(d.a.prototype,"view",(function(t){var o=this.props.post.user();if(!o)return t;var n,e=t.children.find((n="h3",function(t){return t&&t.tag&&t.tag===n})),a=Number(k("rankAmt"));e.children.push(o.ranks().reverse().map((function(t,o){if(!a||o<a)return m("span",{className:"Post-Rank"},y(t))})))}))},w=n(5),N=n.n(w),O=n(14),P=n.n(O),j=n(21),_=n.n(j),I=n(27),L=n.n(I),M=n(2),V=n.n(M),U=n(28),C=n.n(U),D=function(){N.a.prototype.viewItems=function(){var t=this,o=new P.a,n=app.cache.discussionList.sortMap(),e={};for(var a in n)e[a]=app.translator.trans("core.forum.index_sort."+a+"_button");var r=e[this.params().sort]||Object.keys(n).map((function(t){return e[t]}))[0];return/^.*?\/hot/.test(m.route())&&(r=app.translator.trans("core.forum.index_sort.hot_button")),o.add("sort",L.a.component({buttonClassName:"Button",label:r,children:Object.keys(e).map((function(o){var a=e[o],r=(t.params().sort||Object.keys(n)[0])===o;return/^.*?\/hot/.test(m.route())&&"hot"===o&&(r=!0),/^.*?\/hot/.test(m.route())&&"latest"===o&&(r=!1,m.redraw()),V.a.component({children:a,icon:!r||"fas fa-check",onclick:t.changeSort.bind(t,o),active:r})}))})),o},Object(e.extend)(N.a.prototype,"navItems",(function(t){t.add("rankings",C.a.component({href:app.route("rankings"),children:app.translator.trans("fof-gamification.forum.nav.name"),icon:"fas fa-trophy"}),80)})),N.a.prototype.changeSort=function(t){var o=this.params();"hot"===t?(m.route("/"),m.route(m.route()+"hot")):(t===Object.keys(app.cache.discussionList.sortMap())[0]?delete o.sort:o.sort=t,"hot"===o.filter&&delete o.filter,m.route(app.route("index",o)))},Object(e.extend)(_.a.prototype,"sortMap",(function(t){t.hot="hot"})),Object(e.extend)(_.a.prototype,"requestParams",(function(t){"hot"===this.props.params.filter&&(t.filter.q=" is:hot")}))},R=n(15),S=n.n(R),B=n(22),q=n.n(B),A=n(29),T=n.n(A),z=n(4),F=n(30),E=n.n(F),G=n(11),H=n.n(G),J=n(12),K=n.n(J),Q=function(t){function o(){return t.apply(this,arguments)||this}Object(z.a)(o,t);var n=o.prototype;return n.className=function(){return"VotesModal Modal--small"},n.title=function(){return app.translator.trans("fof-gamification.forum.modal.title")},n.content=function(){return m("div",{className:"Modal-body"},m("ul",{className:"VotesModal-list"},m("legend",null,app.translator.trans("fof-gamification.forum.modal.upvotes_label")),this.props.post.upvotes().map((function(t){return m("li",null,m("a",{href:app.route.user(t),config:m.route},H()(t)," ",K()(t)))})),m("legend",null,app.translator.trans("fof-gamification.forum.modal.downvotes_label")),this.props.post.downvotes().map((function(t){return m("li",null,m("a",{href:app.route.user(t),config:m.route},H()(t)," ",K()(t)))}))))},o}(E.a),W=n(8),X=n(10),Y=n.n(X),Z=n(31),tt=n.n(Z),ot=n(32),nt=n.n(ot),et=n(16),at=n.n(et),rt=function(t){function o(){return t.apply(this,arguments)||this}Object(z.a)(o,t);var n=o.prototype;return n.init=function(){t.prototype.init.call(this),app.session.user&&!0===app.session.user.data.attributes.canViewRankingPage||m.route("/"),this.loading=!0,this.users=[],this.refresh()},n.view=function(){var t,o=this;return t=this.loading?tt.a.component():V.a.component({children:app.translator.trans("core.forum.discussion_list.load_more_button"),className:"Button",onclick:this.loadMore.bind(this)}),m("div",{className:"TagsPage"},N.a.prototype.hero(),m("div",{className:"container"},m("nav",{className:"RankingPage-nav IndexPage-nav sideNav",config:N.a.prototype.affixSidebar},m("ul",null,nt()(N.a.prototype.sidebarItems().toArray()))),m("div",{className:"RankingPage sideNavOffset"},m("table",{class:"rankings"},m("tr",null,m("th",{className:"rankings-mobile"},app.translator.trans("fof-gamification.forum.ranking.rank")),m("th",null,app.translator.trans("fof-gamification.forum.ranking.name")),m("th",null,app.translator.trans("fof-gamification.forum.ranking.amount"))),this.users.map((function(t,n){return++n,[m("tr",{className:"ranking-"+n},n<4?k("customRankingImages",!0)?m("img",{className:"rankings-mobile rankings-image",src:app.forum.attribute("baseUrl")+app.forum.attribute("topimage"+n+"Url")}):m("td",{className:"rankings-mobile rankings-"+n},at()("fas fa-trophy")):m("td",{className:"rankings-4 rankings-mobile"},o.addOrdinalSuffix(n)),m("td",null,m("div",{className:"PostUser"},m("h3",{className:"rankings-info"},m("a",{href:app.route.user(t),config:m.route},n<4?H()(t,{className:"info-avatar rankings-"+n+"-avatar"}):""," ",K()(t))))),n<4?m("td",{className:"rankings-"+n},t.points()):m("td",{className:"rankings-4"},t.points()))]}))),m("div",{className:"rankings-loadmore"}," ",t))))},n.refresh=function(t){var o=this;return void 0===t&&(t=!0),t&&(this.loading=!0,this.users=[]),this.loadResults().then((function(t){o.users=[],o.parseResults(t)}),(function(){o.loading=!1,m.redraw()}))},n.addOrdinalSuffix=function(t){if("en"===app.data.attributes.locale){var o=t%10,n=t%100;return 1===o&&11!==n?t+"st":2===o&&12!==n?t+"nd":3===o&&13!==n?t+"rd":t+"th"}return t},n.stickyParams=function(){return{sort:m.route.param("sort"),q:m.route.param("q")}},n.actionItems=function(){var t=new P.a;return t.add("refresh",V.a.component({title:app.translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-refresh",className:"Button Button--icon",onclick:function(){app.cache.discussionList.refresh(),app.session.user&&(app.store.find("users",app.session.user.id()),m.redraw())}})),t},n.newDiscussion=function(){var t=m.deferred();return app.session.user?this.composeNewDiscussion(t):app.modal.show(new S.a({onlogin:this.composeNewDiscussion.bind(this,t)})),t.promise},n.composeNewDiscussion=function(t){var o=new DiscussionComposer({user:app.session.user});return app.composer.load(o),app.composer.show(),t.resolve(o),t.promise},n.loadResults=function(t){var o={};return o.page={offset:t,limit:"10"},app.store.find("rankings",o)},n.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},n.parseResults=function(t){return[].push.apply(this.users,t),this.loading=!1,this.users.sort((function(t,o){return parseFloat(o.points())-parseFloat(t.points())})),m.lazyRedraw(),t},o}(Y.a),st=n(33),it=function(t){function o(){return t.apply(this,arguments)||this}Object(z.a)(o,t);var n=o.prototype;return n.icon=function(){return"Up"===this.props.notification.content()?"fas fa-thumbs-up":"fas fa-thumbs-down"},n.href=function(){return app.route.post(this.props.notification.subject())},n.content=function(){var t=this.props.notification.fromUser();return"Up"===this.props.notification.content()?app.translator.trans("fof-gamification.forum.notification.upvote",{user:t}):app.translator.trans("fof-gamification.forum.notification.downvote",{user:t})},n.excerpt=function(){return this.props.notification.subject().contentPlain()},o}(n.n(st).a),ut=n(34),ct=n.n(ut),pt=n(35),ft=n.n(pt),mt=function(){Object(e.extend)(ct.a.prototype,"infoItems",(function(t){k("showVotesOnDiscussionPage",!0)&&($(".DiscussionListItem-info").find(".item-tags").addClass("gamification"),t.add("discussion-votes",m("span",{className:"DiscussionListItem-votes",title:app.translator.trans("fof-gamification.forum.votes")},at()("far fa-thumbs-up"),ft()(this.props.discussion.votes())),10))}))};r.a.initializers.add("fof-gamification",(function(t){t.store.models.ranks=W.a,t.notificationComponents.vote=it,t.routes.rankings={path:"/rankings",component:rt.component()},function(){Object(e.extend)(q.a.prototype,"config",(function(t,o,n){var a=this;o||r.a.pusher&&r.a.pusher.then((function(t){t.main.bind("newVote",(function(t){var o=parseInt(t.userId);if(o!=r.a.session.user.id()){if(m.startComputation(),a.props.post.id()==t.postId){var n=a.upvotedata(),e=a.downvotedata();switch(t.before){case"up":n=a.removeVote(n,o);break;case"down":e=a.removeVote(e,o)}switch(t.after){case"up":n.unshift({type:"users",id:o});break;case"down":e.unshift({type:"users",id:o});break;case"none":e=a.removeVote(e,o),n=a.removeVote(n,o)}a.downvotedata(e),a.upvotedata(n),m.redraw.strategy("all")}m.endComputation()}})),Object(e.extend)(n,"onunload",(function(){return t.main.unbind("newVote")}))}))})),Object(e.extend)(T.a,"moderationControls",(function(t,o){o.discussion().canSeeVotes()&&t.add("viewVotes",[m(V.a,{icon:"fas fa-thumbs-up",onclick:function(){r.a.modal.show(new Q({post:o}))}},r.a.translator.trans("fof-gamification.forum.mod_item"))])}));var t=function(t,o,n,e){if(r.a.session.user){if(t.discussion().canVote())return o&&n&&(o=!1,n=!1),e(!0),t.save([o,n,"vote"]).then((function(){return null}),(function(){return null})).then((function(){e(!1),t.discussion().pushAttributes({votes:t.votes()}),m.redraw()}))}else r.a.modal.show(new S.a)};Object(e.extend)(q.a.prototype,"actionItems",(function(o){var n=this,e=this.props.post,a=e.hasDownvoted(),s=e.hasUpvoted(),i=k("iconName")||"thumbs",u=e.discussion().canVote();o.add("upvote",V.a.component({icon:this.voteLoading||"fas fa-"+i+"-up",className:"Post-vote Post-upvote",style:s&&{color:r.a.forum.attribute("themePrimaryColor")},loading:this.voteLoading,disabled:this.voteLoading||!u,onclick:function(){return t(e,!s,!1,(function(t){return n.voteLoading=t}))}}),3),o.add("points",m("label",{className:"Post-points"},e.votes()),2),o.add("downvote",V.a.component({icon:this.voteLoading||"fas fa-"+i+"-down",className:"Post-vote Post-downvote",style:a&&{color:r.a.forum.attribute("themePrimaryColor")},loading:this.voteLoading,disabled:!e.discussion().canVote(),onclick:function(){return t(e,!1,!a,(function(t){return n.voteLoading=t}))}}),1)}))}(),D(),x(),mt()}))},,function(t,o){t.exports=flarum.core.compat["components/PostUser"]},function(t,o){t.exports=flarum.core.compat["components/Dropdown"]},function(t,o){t.exports=flarum.core.compat["components/LinkButton"]},function(t,o){t.exports=flarum.core.compat["utils/PostControls"]},function(t,o){t.exports=flarum.core.compat["components/Modal"]},function(t,o){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,o){t.exports=flarum.core.compat["helpers/listItems"]},function(t,o){t.exports=flarum.core.compat["components/Notification"]},function(t,o){t.exports=flarum.core.compat["components/DiscussionListItem"]},function(t,o){t.exports=flarum.core.compat["utils/abbreviateNumber"]},,,,,function(t,o,n){"use strict";n.r(o);var e=n(7);for(var a in e)"default"!==a&&function(t){n.d(o,t,(function(){return e[t]}))}(a);n(24)}]);
//# sourceMappingURL=forum.js.map